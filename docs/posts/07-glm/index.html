<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Joshua Marie">
<meta name="dcterms.date" content="2025-11-23">
<meta name="description" content="Finally understand what a link function actually does instead of just copy-pasting glm()">
<title>Tutorial on Generalized Linear Model from scratch – Joshua Marie</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/jm-favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0a95de2c3be981c2e03029825b16c585.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c2a4070949356990582fa11d5da3dd57.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/all.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9842567530621468" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../styles/base.css">
<link rel="stylesheet" href="../../styles/layout.css">
<link rel="stylesheet" href="../../styles/hero.css">
<link rel="stylesheet" href="../../styles/cards.css">
<link rel="stylesheet" href="../../styles/about.css">
<link rel="stylesheet" href="../../styles/dark-mode.css">
<link rel="stylesheet" href="../Theme/code.css">
<link rel="stylesheet" href="../Theme/table.css">
<meta name="twitter:title" content="Tutorial on Generalized Linear Model from scratch – Joshua Marie">
<meta name="twitter:description" content="Finally understand what a link function actually does instead of just copy-pasting glm()">
<meta name="twitter:image" content="https://joshuamarie.com/posts/07-glm/image.png">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="1536">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joshua Marie</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../services.html"> 
<span class="menu-text">Services</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contacts.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">My resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joshuamarie"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joshuamarie/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joshua.marie.k@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS Feed">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tutorial on Generalized Linear Model from scratch</h1>
            <p class="subtitle lead">Dogmatic statistics for fun series</p>
                  <div>
        <div class="description">
          Finally understand what a link function actually does instead of just copy-pasting glm()
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Python</div>
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">machine-learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joshua Marie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 23, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#lets-start-with-an-overview" id="toc-lets-start-with-an-overview" class="nav-link active" data-scroll-target="#lets-start-with-an-overview"><span class="header-section-number">1</span> Let’s start with an overview</a>
  <ul class="collapse">
<li><a href="#but-wait-whats-this-gmu-doing-here" id="toc-but-wait-whats-this-gmu-doing-here" class="nav-link" data-scroll-target="#but-wait-whats-this-gmu-doing-here"><span class="header-section-number">1.1</span> But wait, what’s this <span class="math inline">\(g(\mu)\)</span> doing here?</a></li>
  <li><a href="#why-cant-we-just-minimize-squared-errors" id="toc-why-cant-we-just-minimize-squared-errors" class="nav-link" data-scroll-target="#why-cant-we-just-minimize-squared-errors"><span class="header-section-number">1.2</span> Why Can’t We Just Minimize Squared Errors?</a></li>
  <li><a href="#the-three-sacred-components-of-glm" id="toc-the-three-sacred-components-of-glm" class="nav-link" data-scroll-target="#the-three-sacred-components-of-glm"><span class="header-section-number">1.3</span> The Three Sacred Components of GLM</a></li>
  <li><a href="#why-linear-regression-is-just-a-special-case" id="toc-why-linear-regression-is-just-a-special-case" class="nav-link" data-scroll-target="#why-linear-regression-is-just-a-special-case"><span class="header-section-number">1.4</span> Why Linear Regression is Just a Special Case</a></li>
  </ul>
</li>
  <li>
<a href="#math" id="toc-math" class="nav-link" data-scroll-target="#math"><span class="header-section-number">2</span> In-depth mathematics and computation</a>
  <ul class="collapse">
<li><a href="#mle" id="toc-mle" class="nav-link" data-scroll-target="#mle"><span class="header-section-number">2.1</span> Maximum Likelihood Estimation</a></li>
  <li><a href="#irls" id="toc-irls" class="nav-link" data-scroll-target="#irls"><span class="header-section-number">2.2</span> Fisher Scoring / IRLS Algorithm (The Actual Work)</a></li>
  <li><a href="#deviance" id="toc-deviance" class="nav-link" data-scroll-target="#deviance"><span class="header-section-number">2.3</span> Be deviant: Deviance (GLM’s Version of Sum of Squares)</a></li>
  </ul>
</li>
  <li><a href="#full-function-implementation" id="toc-full-function-implementation" class="nav-link" data-scroll-target="#full-function-implementation"><span class="header-section-number">3</span> Full Function implementation</a></li>
  <li>
<a href="#show-me-the-money-mtcars-logistic-regression-showdown" id="toc-show-me-the-money-mtcars-logistic-regression-showdown" class="nav-link" data-scroll-target="#show-me-the-money-mtcars-logistic-regression-showdown"><span class="header-section-number">4</span> Show Me the Money: mtcars Logistic Regression Showdown</a>
  <ul class="collapse">
<li><a href="#tier-1-the-lazy-way-everyone-does-this" id="toc-tier-1-the-lazy-way-everyone-does-this" class="nav-link" data-scroll-target="#tier-1-the-lazy-way-everyone-does-this"><span class="header-section-number">4.1</span> Tier 1: The lazy way (everyone does this)</a></li>
  <li><a href="#tier-2-the-i-implemented-irls-at-3-am-way" id="toc-tier-2-the-i-implemented-irls-at-3-am-way" class="nav-link" data-scroll-target="#tier-2-the-i-implemented-irls-at-3-am-way"><span class="header-section-number">4.2</span> Tier 2: The “I Implemented IRLS at 3 AM” way</a></li>
  </ul>
</li>
  <li>
<a href="#when-things-go-wrong-trust-me-they-will" id="toc-when-things-go-wrong-trust-me-they-will" class="nav-link" data-scroll-target="#when-things-go-wrong-trust-me-they-will"><span class="header-section-number">5</span> When Things Go Wrong (Trust me, they Will)</a>
  <ul class="collapse">
<li><a href="#my-model-wont-converge" id="toc-my-model-wont-converge" class="nav-link" data-scroll-target="#my-model-wont-converge"><span class="header-section-number">5.1</span> “My model won’t converge!”</a></li>
  <li><a href="#my-coefficients-are-huge" id="toc-my-coefficients-are-huge" class="nav-link" data-scroll-target="#my-coefficients-are-huge"><span class="header-section-number">5.2</span> “My coefficients are huge!”</a></li>
  <li><a href="#the-deviance-is-gigantic" id="toc-the-deviance-is-gigantic" class="nav-link" data-scroll-target="#the-deviance-is-gigantic"><span class="header-section-number">5.3</span> “The deviance is gigantic!”</a></li>
  <li><a href="#im-getting-warnings-about-fitted-probabilities-of-0-or-1" id="toc-im-getting-warnings-about-fitted-probabilities-of-0-or-1" class="nav-link" data-scroll-target="#im-getting-warnings-about-fitted-probabilities-of-0-or-1"><span class="header-section-number">5.4</span> “I’m getting warnings about fitted probabilities of 0 or 1”</a></li>
  </ul>
</li>
  <li><a href="#final-boss-wisdom" id="toc-final-boss-wisdom" class="nav-link" data-scroll-target="#final-boss-wisdom"><span class="header-section-number">6</span> Final Boss Wisdom</a></li>
  <li><a href="#some-good-references" id="toc-some-good-references" class="nav-link" data-scroll-target="#some-good-references"><span class="header-section-number">7</span> Some good references</a></li>
  <li><a href="#appendix-cheat-sheet" id="toc-appendix-cheat-sheet" class="nav-link" data-scroll-target="#appendix-cheat-sheet"><span class="header-section-number">8</span> Appendix — Cheat Sheet</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/edit/main/posts/07-glm/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="page-columns page-rows-contents page-layout-article"><div class="social-share">
<a href="https://twitter.com/share?url=https://joshuamarie.com/posts/07-glm&amp;text=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://joshuamarie.com/posts/07-glm&amp;title=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie&amp;body=Check%20out%20this%20link:https://joshuamarie.com/posts/07-glm" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://joshuamarie.com/posts/07-glm" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://joshuamarie.com/posts/07-glm&amp;title=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://joshuamarie.com/posts/07-glm&amp;title=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://joshuamarie.com/posts/07-glm&amp;name=Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a><a href="javascript:void(0);" onclick="var mastodon_instance=prompt('Mastodon Instance / Server Name?'); if(typeof mastodon_instance==='string' &amp;&amp; mastodon_instance.length){this.href='https://'+mastodon_instance+'/share?text=Tutorial on Generalized Linear Model - Joshua Marie https://joshuamarie.com/posts/07-glm'}else{return false;}" target="_blank" class="mastodon"><i class="fa-brands fa-mastodon fa-fw fa-lg"></i></a><a href="https://bsky.app/intent/compose?text=https://joshuamarie.com/posts/07-glm%20Tutorial%20on%20Generalized%20Linear%20Model%20-%20Joshua%20Marie" target="_blank" class="bsky"><i class="fa-brands fa-bluesky"></i></a>
</div></div>


<p>Stop asking:</p>
<ul>
<li>“What test do I need to use?”</li>
<li>“Do my data need to be normally distributed?”</li>
<li>“Can I just use linear regression on counts lol?”</li>
</ul>
<p><img src="spongebob-brain-on-fire.gif" class="img-fluid"></p>
<p>Kidding~</p>
<p>I have no such problem of you guys asking these questions. This type of question, however, is a type of question that I heard many times already. I mean, I understand why there’s so many misconceptions, and it could be they are not properly taught or…I don’t know.</p>
<p>I have no problems with tutorials and blogs online about teaching statistics, like predicting what species of iris is gonna be, or how likely you’ll get ebola. There are ten thousand blog posts teaching you how to predict iris species with <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>, or Python’s <code>sklearn.linear_model.LogisticRegression()</code></p>
<p>Today we’re going <strong>full math gremlin mode</strong> and actually understanding why GLMs exist, why linear regression is a lie for most real data, and why the link function is the most genius hack in 20th-century statistics.</p>
<section id="lets-start-with-an-overview" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="lets-start-with-an-overview">
<span class="header-section-number">1</span> Let’s start with an overview</h2>
<p><img src="lr.jpg" class="img-fluid"></p>
<p>What did you observe on the mathematical model formula of linear regression and generalized linear model (GLM)?</p>
<p>Take a look:</p>
<p><strong><em>Linear Regression:</em></strong></p>
<p><span class="math display">\[Y = \mathbf{X}\beta\ +\ \epsilon\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}\beta\)</span> expands to: <span class="math display">\[\beta_0 + x_1\beta_1 + x_2\beta_2 + x_3\beta_3 + \dots + x_n\beta_n\]</span></p>
<p>How about on GLM?</p>
<p><span class="math display">\[
g(\mu_i) = \mathbf{x}_i^\top \boldsymbol{\beta} = \eta_i \quad \text{(linear predictor)}
\]</span></p>
<p><span class="math display">\[g(\mu)=\eta=\mathbf{X}\beta\]</span></p>
<p>both are taking the account of the linear model, where the response have linear relationship with the predictors, taken account by <span class="math inline">\(\mathbf{X}\beta\)</span>.</p>
<p>There are few exceptions:</p>
<ol type="1">
<li><p>GLMs can take handle of the range not only lies on the real number, but with some strict intervals, unlike Linear regression who has always a range lies on the real number.</p></li>
<li>
<p>GLMs doesn’t have an error term. Why is that? GLMs takes considerations on the <em>expected value</em> of the linear model, and when you take the expected value like this:</p>
<p><span class="math display">\[E(Y)=E(\mathbf{X}\beta\ + \ \epsilon)\]</span></p>
<p>The expected values <span class="math inline">\(E(\mathbf{X}\beta) = \mathbf{X}\beta\)</span> (assuming no randomness in both terms here) and <span class="math inline">\(E(\epsilon) = 0\)</span>. Hence:</p>
<p><span class="math display">\[E(Y)=\mathbf{X}\beta\]</span></p>
<p>and GLMs only care about the expected value</p>
</li>
</ol>
<section id="but-wait-whats-this-gmu-doing-here" class="level3" data-number="1.1"><h3 data-number="1.1" class="anchored" data-anchor-id="but-wait-whats-this-gmu-doing-here">
<span class="header-section-number">1.1</span> But wait, what’s this <span class="math inline">\(g(\mu)\)</span> doing here?</h3>
<p>Yes, it’s odd, but hey, it just works.</p>
<p>There’s this thing called <strong>link function</strong>, and it’s the reason GLMs exist. Let me break down why we need this weird little function:</p>
<p>In linear regression, the mean of the model would be: <span class="math display">\[\mu = E(Y) = \mathbf{X}\beta\]</span></p>
<p>Okay, this definitely feels like “Hey, it works, okay?”, but that’s my intuition about GLMs. I hope you understood a little in this part. Anyways, that’s the mean of the linear regression that we know of, and this works great when <span class="math inline">\(y\)</span> can be any real number. But, I am asking you a question:</p>
<p>What if your outcome isn’t allowed to be just any real number?</p>
<ul>
<li>What if <span class="math inline">\(Y\)</span> is a <em>count</em> <span class="math inline">\((0, 1, 2, 3, ...)\)</span>? Let’s say <em>number of kids in a family</em> — <span class="math inline">\(\mathbf{X}\beta\)</span> could give you -3.7 customers</li>
<li>What if <span class="math inline">\(Y\)</span> is a <em>probability</em> (0 to 1)? Probability of rain? Between 0 and 1, inclusive, you monster</li>
<li>What if <span class="math inline">\(Y\)</span> is <em>binary</em> (0 or 1)? Let’s say “whether someone clicks your ad” — <span class="math inline">\(\mathbf{X}\beta\)</span> could give you 0.3, and it can’t be 1.337, you know.</li>
</ul>
<p>This strange thing-y in GLMs, link function <span class="math inline">\(g(\cdot)\)</span>, solves this by transforming the mean so that the linear predictor <span class="math inline">\(\eta = \mathbf{X}\beta\)</span> can be any real number, while <span class="math inline">\(\mu\)</span> stays in the valid range.</p>
<p>Understand? No? Alright, let’s say, the output of <span class="math inline">\(\eta\)</span>, which is an equivalent of <span class="math inline">\(\mathbf{X}\beta\)</span>, should be at least close to the value in <span class="math inline">\(g(\mu)\)</span>, which is an equivalent of <span class="math inline">\(g(E(y))\)</span>.</p>
<p>Mathematically: <span class="math display">\[g(\mu) = \eta = \mathbf{X}\beta\]</span></p>
<p>So the inverse is: <span class="math display">\[\mu = g^{-1}(\eta) = g^{-1}(\mathbf{X}\beta)\]</span></p>
<p>Again, to understand, we fit the model in “transformed space” where everything is linear, then transform back to get predictions in the correct range.</p>
<p><strong>List of common link functions:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 19%">
<col style="width: 40%">
<col style="width: 19%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th>Link</th>
<th><span class="math inline">\(g(\mu)\)</span></th>
<th><span class="math inline">\(\mu = g^{-1}(\eta)\)</span></th>
<th>Used for</th>
<th>Why</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Identity</td>
<td><span class="math inline">\(\mu\)</span></td>
<td><span class="math inline">\(\eta\)</span></td>
<td>Normal/Gaussian</td>
<td>No transformation needed</td>
</tr>
<tr class="even">
<td>Logit</td>
<td><span class="math inline">\(\log\left(\frac{\mu}{1-\mu}\right)\)</span></td>
<td><span class="math inline">\(\frac{1}{1+e^{-\eta}}\)</span></td>
<td>Binomial/Binary</td>
<td>Maps <span class="math inline">\((0,1) \to (-\infty, \infty)\)</span>
</td>
</tr>
<tr class="odd">
<td>Log</td>
<td><span class="math inline">\(\log(\mu)\)</span></td>
<td><span class="math inline">\(e^{\eta}\)</span></td>
<td>Poisson/Counts</td>
<td>Maps <span class="math inline">\((0, \infty) \to (-\infty, \infty)\)</span>
</td>
</tr>
<tr class="even">
<td>Probit</td>
<td><span class="math inline">\(\Phi^{-1}(\mu)\)</span></td>
<td><span class="math inline">\(\Phi(\eta)\)</span></td>
<td>Binomial</td>
<td>For masochists</td>
</tr>
</tbody>
</table></section><section id="why-cant-we-just-minimize-squared-errors" class="level3" data-number="1.2"><h3 data-number="1.2" class="anchored" data-anchor-id="why-cant-we-just-minimize-squared-errors">
<span class="header-section-number">1.2</span> Why Can’t We Just Minimize Squared Errors?</h3>
<p>In linear regression, we minimize the sum of squared residuals (SSR): <span class="math display">\[SSR = \sum_{i}(Y_i - \hat{Y}_i)^2 = \sum_{i}(Y_i - \mathbf{X}\beta)^2\]</span></p>
<p>This has a nice closed-form solution and works because:</p>
<ul>
<li>The errors are approximately normally distributed</li>
<li>The variance is constant (a.k.a. homoscedasticity)</li>
<li>Minimizing SSR is equivalent to maximum likelihood estimation</li>
</ul>
<p>But in GLMs, these assumptions break down:</p>
<ul>
<li>Binomial data has variance <span class="math inline">\(\mu(1-\mu)\)</span>, which depends on the mean</li>
<li>Poisson data has variance equal to the mean <span class="math inline">\(\mu\)</span>
</li>
<li>The response isn’t always in real number or approximately normally distributed (even with the presence of CLT)</li>
</ul>
<p>So we need the alternative approach: <strong>Maximum Likelihood Estimation</strong> — this is the alternative estimation method for Linear regression.</p>
<p>In GLM, it will be proven difficult to estimate the optimal solution as the use case will become different. You see the table above? There are actually plenty of them.</p>
</section><section id="the-three-sacred-components-of-glm" class="level3" data-number="1.3"><h3 data-number="1.3" class="anchored" data-anchor-id="the-three-sacred-components-of-glm">
<span class="header-section-number">1.3</span> The Three Sacred Components of GLM</h3>
<p>Every GLM has exactly three components. Forget one at your dissertation defense, I dare you:</p>
<ol type="1">
<li>
<p>Random Component (Distribution Family)</p>
<p>Your response <span class="math inline">\(Y\)</span> has a likelihood function, expressed in an <strong>exponential family distribution</strong>. The fancy math looks like: <span class="math display">\[f(Y; \theta, \phi) = \exp\left\{\frac{Y\theta - b(\theta)}{a(\phi)} + c(Y, \phi)\right\}\]</span></p>
<p>Translation: Normal, Binomial, Poisson, Gamma — they’re all in this family because they can be written in this form.</p>
<p>Why do we care? Because exponential family distributions have nice properties:</p>
<ul>
<li>
<span class="math inline">\(E[Y] = b'(\theta)\)</span> (the mean is the derivative of that <span class="math inline">\(b\)</span> function)</li>
<li>
<span class="math inline">\(\text{Var}(Y) = b''(\theta) \cdot a(\phi)\)</span> (variance is also derived from <span class="math inline">\(b\)</span>)</li>
</ul>
</li>
<li>
<p>Systematic Component (Linear Predictor)</p>
<p><span class="math display">\[\eta = \mathbf{X}\beta = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots\]</span></p>
<p>This is just your boring linear combination of predictors. Nothing fancy. We’re still doing regression.</p>
</li>
<li>
<p>Link Function</p>
<p><span class="math display">\[g(\mu) = \eta\]</span></p>
<p>Connects your linear predictor <span class="math inline">\(\eta\)</span> (which lives in <span class="math inline">\((-\infty, \infty)\)</span>) to your mean response <span class="math inline">\(\mu\)</span> (which might live in <span class="math inline">\((0, 1)\)</span> or <span class="math inline">\([0, \infty)\)</span> or wherever your response is allowed to be).</p>
</li>
</ol></section><section id="why-linear-regression-is-just-a-special-case" class="level3" data-number="1.4"><h3 data-number="1.4" class="anchored" data-anchor-id="why-linear-regression-is-just-a-special-case">
<span class="header-section-number">1.4</span> Why Linear Regression is Just a Special Case</h3>
<p>Notice that if you:</p>
<ul>
<li>Use the <strong>Normal distribution</strong> (random component)</li>
<li>Its <em>identity link</em> <span class="math inline">\(g(\mu) = \mu\)</span> (link function)</li>
<li>Keep the linear predictor <span class="math inline">\(\eta = \mathbf{X}\beta\)</span> (systematic component)</li>
</ul>
<p>You get just it:</p>
<p><span class="math display">\[\mu = \mathbf{X}\beta\]</span></p>
<p>which itself is equivalent to <span class="math inline">\(E(y)\)</span></p>
<p>Which is just…your good old ordinary regression:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>In R
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>In Python
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>smf. \ </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    ols(<span class="st">"y ~ x"</span>, data <span class="op">=</span> data). <span class="op">\</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    fit(). \ </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    summary()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>Linear regression is a GLM with no identity, literally and figuratively.</p>
<hr></section></section><section id="math" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="math">
<span class="header-section-number">2</span> In-depth mathematics and computation</h2>
<p><img src="math.gif" class="img-fluid"></p>
<p><em>What mathematics do I need to know more?</em></p>
<p>Now, you know it takes a lot to optimize the GLM. What are the things you need to know?</p>
<p>First, in Linear regression, we have two ways to estimate the coefficients: MLE and ordinary least squares (OLS), which also can be derived and closed form from the maximum likelihood of the normal distribution. In GLM, we cannot use OLS, thus no closed form solution and <a href="#mle">MLE</a> is the only main solution.</p>
<p>Then for the extra part, which we talk about the <a href="#deviance">deviance</a>. Imagine this as the residual sum of squares in GLMs.</p>
<section id="mle" class="level3" data-number="2.1"><h3 data-number="2.1" class="anchored" data-anchor-id="mle">
<span class="header-section-number">2.1</span> Maximum Likelihood Estimation</h3>
<p>But how do we actually estimate <span class="math inline">\(\beta\)</span>? We use <em>maximum likelihood estimation</em> (MLE), but considering there are many forms of likelihood functions, derived from several probability distributions came from exponential family, and so there’s several link functions to be derived.</p>
<p>The likelihood for a GLM is:</p>
<p><span class="math display">\[L(\beta) = \prod_{i=1}^n f(y_i; \theta_i, \phi)=\prod_{i=1}^n\exp\left\{\frac{y_i\theta_i - b(\theta_i)}{a(\phi)} + c(y_i, \phi)\right\}\]</span></p>
<p>Fancy, isn’t it?</p>
<p>SIKE!!</p>
<p><img src="sike.gif" class="img-fluid"></p>
<p>You don’t want this, trust me. This thing is so hard to calculate, even the computer starts to act crazy if you really direcly executed a program for this. Direct maximization of this product is computationally difficult. Taking logarithms simplifies things enormously (thanks, John Napier!).</p>
<p>A sane person would only like what’s the easier to eat — The log-likelihood function for the GLM instead:</p>
<p><span class="math display">\[\ell(\beta) = \sum_{i=1}^n \left\{\frac{y_i\theta_i - b(\theta_i)}{a(\phi)} + c(y_i, \phi)\right\}\]</span></p>
<p>Now, this is much easier to work with because:</p>
<ul>
<li>Products become sums</li>
<li>It’s numerically more stable</li>
<li>The maximum is the same (logarithm is monotonic, after all)</li>
</ul></section><section id="irls" class="level3" data-number="2.2"><h3 data-number="2.2" class="anchored" data-anchor-id="irls">
<span class="header-section-number">2.2</span> Fisher Scoring / IRLS Algorithm (The Actual Work)</h3>
<p>Since, there’s no actual closed form to calculate the coefficients, we can’t solve <span class="math inline">\(U(\beta) = 0\)</span> directly. There’s a method we can use called <strong>Iteratively Reweighted Least Squares (IRLS)</strong>, which is just Newton-Raphson but with the Fisher Information Matrix, denoted as <span class="math inline">\(W\)</span>.</p>
<p>Before starting, we need to assign a variable that arbitrarily assigns design matrix <code>X</code>, the response vector <code>y</code>, and then determines the number of predictors <code>p</code>, the number of observations <code>n</code>, the maximum iteration <code>max_iter</code>, and the tolerance <code>eps</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">In R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">In Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">eps</span> <span class="op">=</span> <span class="fl">1e-7</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> X.shape[<span class="dv">0</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> X.shape[<span class="dv">1</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>max_iter <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">1e-7</span>  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>Here are the steps:</p>
<section id="the-algorithm" class="level4" data-number="2.2.1"><h4 data-number="2.2.1" class="anchored" data-anchor-id="the-algorithm">
<span class="header-section-number">2.2.1</span> 1. <strong>The Algorithm:</strong>
</h4>
<p>Start with initial values <span class="math inline">\(\beta^{(0)}\)</span> (usually from an unweighted regression or just zeros).</p>
<p>This is how you program it in R and Python:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">p</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> np.zeros((p, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section><section id="repeat-until-convergence" class="level4" data-number="2.2.2"><h4 data-number="2.2.2" class="anchored" data-anchor-id="repeat-until-convergence">
<span class="header-section-number">2.2.2</span> 2. <strong>Repeat until convergence:</strong>
</h4>
<p>In this step, the extra steps, i.e.:</p>
<ul>
<li><p>Calculate linear predictor: <span class="math inline">\(\eta^{(t)} = \mathbf{X}\beta^{(t)}\)</span></p></li>
<li><p>Calculate fitted values: <span class="math inline">\(\mu^{(t)} = g^{-1}(\eta^{(t)})\)</span></p></li>
<li>
<p>Calculate weights:</p>
<p><span class="math display">\[w_i^{(t)} = \frac{1}{\text{Var}(Y_i)} \left(\frac{\partial \mu_i}{\partial \eta_i}\right)^2\]</span></p>
</li>
<li>
<p>Calculate working response:</p>
<p><span class="math display">\[z_i^{(t)} = \eta_i^{(t)} + (y_i - \mu_i^{(t)}) \frac{\partial \eta_i}{\partial \mu_i}\]</span></p>
</li>
<li>
<p>Update coefficients by solving weighted least squares:</p>
<p><span class="math display">\[\beta^{(t+1)} = (\mathbf{X}^T W^{(t)} \mathbf{X})^{-1} \mathbf{X}^T W^{(t)} z^{(t)}\]</span></p>
</li>
<li><p>Check convergence: If <span class="math inline">\(|\beta^{(t+1)} - \beta^{(t)}| &lt; \epsilon\)</span>, stop. Else, go back to step 1.</p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># 1. Calculate linear predictor</span></span>
<span>    <span class="va">eta</span> <span class="op">=</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">beta</span></span>
<span>    </span>
<span>    <span class="co"># 2. Calculate fitted values</span></span>
<span>    <span class="va">mu</span> <span class="op">=</span> <span class="va">family</span><span class="op">$</span><span class="fu">linkinv</span><span class="op">(</span><span class="va">eta</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># 3. Calculate weights</span></span>
<span>    <span class="va">V</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">family</span><span class="op">$</span><span class="fu">variance</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">gradient</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">family</span><span class="op">$</span><span class="fu">mu.eta</span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">w_vec</span> <span class="op">=</span> <span class="op">(</span><span class="va">gradient</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">V</span></span>
<span>    </span>
<span>    <span class="co"># 4. Working response</span></span>
<span>    <span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span> <span class="op">/</span> <span class="va">gradient</span></span>
<span>    </span>
<span>    <span class="co"># 5. Update coefficients by solving weighted least squares</span></span>
<span>    <span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">w_vec</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">beta_new</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">z</span></span>
<span>    </span>
<span>    <span class="co"># 6. Check convergence</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">beta_new</span> <span class="op">-</span> <span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">beta</span> <span class="op">=</span> <span class="va">beta_new</span></span>
<span>        <span class="va">converged</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="kw">break</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Final beta</span></span>
<span>    <span class="va">beta</span> <span class="op">=</span> <span class="va">beta_new</span></span>
<span><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(max_iter):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Calculate linear predictor</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    eta <span class="op">=</span> X <span class="op">@</span> beta</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Calculate fitted values</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> family.linkinv(eta)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Calculate weights</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> family.variance(mu).flatten()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    gradient <span class="op">=</span> family.mu_eta(eta).flatten()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    w_vec <span class="op">=</span> (gradient <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> V</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Working response</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> eta <span class="op">+</span> (y <span class="op">-</span> mu) <span class="op">/</span> gp</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Update coefficients by solving weighted least squares</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    W <span class="op">=</span> np.diag(w_vec)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    beta_new <span class="op">=</span> np.linalg.inv(X.T <span class="op">@</span> W <span class="op">@</span> X) <span class="op">@</span> (X.T <span class="op">@</span> W <span class="op">@</span> z)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Check convergence</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">max</span>(np.<span class="bu">abs</span>(beta_new <span class="op">-</span> beta)) <span class="op">&lt;</span> tol:</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> beta_new</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        converged <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final beta</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> beta_new</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section></section><section id="deviance" class="level3" data-number="2.3"><h3 data-number="2.3" class="anchored" data-anchor-id="deviance">
<span class="header-section-number">2.3</span> Be deviant: Deviance (GLM’s Version of Sum of Squares)</h3>
<p>To be frank, I am not planning to include this, but I was thinking if anyone is curious on how the fitness in GLMs is being measured. In Linear regression, we measure model fit by summarizing the residuals using Residual Sum of Squares (RSS). It is so odd for GLM to use other way to measure (well, the key term is “Generalized”, after all) — Instead, GLMs use <strong>deviance</strong>:</p>
<p><span class="math display">\[D = 2[\ell(\text{saturated model}) - \ell(\text{fitted model})]\]</span></p>
<p>The saturated model has <span class="math inline">\(\hat{\mu}_i = y_i\)</span> (perfect fit). Deviance measures how much worse your model is than this.</p>
<p><strong>For specific families:</strong></p>
<ul>
<li>
<strong>Normal / Gaussian</strong>: <span class="math inline">\(D = \sum(y_i - \hat{\mu}_i)^2\)</span> (literally just RSS)</li>
<li>
<strong>Poisson</strong>: <span class="math inline">\(D = 2\sum\left[y_i\log\left(\frac{y_i}{\hat{\mu}_i}\right) - (y_i - \hat{\mu}_i)\right]\)</span>
</li>
<li>
<strong>Binomial</strong>: <span class="math inline">\(D = 2\sum\left[y_i\log\left(\frac{y_i}{\hat{\mu}_i}\right) + (n_i-y_i)\log\left(\frac{n_i-y_i}{n_i-\hat{\mu}_i}\right)\right]\)</span>
</li>
</ul>
<p>Lower deviance = better fit.</p>
</section></section><section id="full-function-implementation" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="full-function-implementation">
<span class="header-section-number">3</span> Full Function implementation</h2>
<p>The main programming languages are still R and Python. The functions I implemented expects to be brittle and not applicable for some cases.</p>
<p><em>The functions are implemented in this <a href="https://github.com/joshuamarie/joshuamarie/tree/main/posts/07-glm">source code</a></em>.</p>
<hr></section><section id="show-me-the-money-mtcars-logistic-regression-showdown" class="level2" data-number="4"><h2 data-number="4" class="anchored" data-anchor-id="show-me-the-money-mtcars-logistic-regression-showdown">
<span class="header-section-number">4</span> Show Me the Money: mtcars Logistic Regression Showdown</h2>
<p><em>Okay, enough theory — show me the money!</em></p>
<p>Now, we can implement a full function only from <a href="#math"><em>In-depth mathematics and computation</em></a>. That is, if you only need the coefficients. Use any dataset you want, but on our example, we’ll use the <code>mtcars</code> dataset for the simpletons.</p>
<p>Why <code>mtcars</code>? Because every R tutorial on earth has used it at least once, and I’m not about to break tradition, am I? We’ll predict whether a car has an automatic (0) or manual (1) transmission (<code>am</code>) using horsepower (<code>hp</code>), and weight (<code>wt</code>). Classic binary outcome -&gt; logistic regression -&gt; GLM with binomial family and logit link.</p>
<p>We’ll do it three ways so you can flex at parties:</p>
<ol type="1">
<li>The lazy way (<code><a href="https://rdrr.io/r/stats/glm.html">stats::glm()</a></code> in R / <code>{statsmodels}</code> in Python)</li>
<li>The “I Implemented IRLS at 3 AM” way (calling our own IRLS function in this <a href="#irls">part</a>)</li>
</ol>
<section id="tier-1-the-lazy-way-everyone-does-this" class="level3" data-number="4.1"><h3 data-number="4.1" class="anchored" data-anchor-id="tier-1-the-lazy-way-everyone-does-this">
<span class="header-section-number">4.1</span> Tier 1: The lazy way (everyone does this)</h3>
<p>This is the “why should I bother making myself one if there’s one existed already” part. R has built-in <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> from <code>{stats}</code> package, while Python has <code>{statsmodels}</code> package, ideally under <code>statsmodels.api</code>, not under <code>statsmodels.formula.api</code>, but for our example, we can use that instead.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_r</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = am ~ hp + wt, family = binomial(link = "logit"), 
    data = mtcars)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept) 18.86630    7.44356   2.535  0.01126 * 
hp           0.03626    0.01773   2.044  0.04091 * 
wt          -8.08348    3.06868  -2.634  0.00843 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 43.230  on 31  degrees of freedom
Residual deviance: 10.059  on 29  degrees of freedom
AIC: 16.059

Number of Fisher Scoring iterations: 8</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.genmod.families <span class="im">import</span> Binomial</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.genmod.families.links <span class="im">import</span> Logit</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars = sm.datasets.get_rdataset("mtcars").data</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>mtcars <span class="op">=</span> r.mtcars</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>fit_py <span class="op">=</span> smf <span class="op">\</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    .glm(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"am ~ hp + wt"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>mtcars,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        family<span class="op">=</span>Binomial(link<span class="op">=</span>Logit())</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">\</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    .fit()</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fit_py.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                     am   No. Observations:                   32
Model:                            GLM   Df Residuals:                       29
Model Family:                Binomial   Df Model:                            2
Link Function:                  Logit   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -5.0296
Date:                Thu, 04 Dec 2025   Deviance:                       10.059
Time:                        15:29:32   Pearson chi2:                     15.0
No. Iterations:                     8   Pseudo R-squ. (CS):             0.6453
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     18.8663      7.444      2.535      0.011       4.277      33.455
hp             0.0363      0.018      2.044      0.041       0.001       0.071
wt            -8.0835      3.069     -2.634      0.008     -14.098      -2.069
==============================================================================</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="tier-2-the-i-implemented-irls-at-3-am-way" class="level3" data-number="4.2"><h3 data-number="4.2" class="anchored" data-anchor-id="tier-2-the-i-implemented-irls-at-3-am-way">
<span class="header-section-number">4.2</span> Tier 2: The “I Implemented IRLS at 3 AM” way</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<blockquote class="blockquote">
<p>View the <a href="https://github.com/joshuamarie/joshuamarie/tree/main/posts/07-glm/glm.r">source code</a></p>
</blockquote>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">.</span><span class="op">/</span><span class="va">glm</span><span class="op">[</span><span class="va">glm_custom</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glm_custom</span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$coefficients
[1] 18.8662987  0.0362556 -8.0834752

$converged
[1] TRUE

$iterations
[1] 9</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<blockquote class="blockquote">
<p>View the <a href="https://github.com/joshuamarie/joshuamarie/tree/main/posts/07-glm/glm.py">source code</a></p>
</blockquote>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glm <span class="im">import</span> glm_custom</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glm</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(glm_custom(<span class="st">'am ~ hp + wt'</span>, data <span class="op">=</span> mtcars, family <span class="op">=</span> glm.Binomial()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'coefficients': {'Intercept': np.float64(18.866298717203943), 'hp': np.float64(0.03625559608221654), 'wt': np.float64(-8.083475182444579)}, 'converged': True, 'iterations': 9, 'beta_vector': array([[18.86629872],
       [ 0.0362556 ],
       [-8.08347518]])}</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr></section></section><section id="when-things-go-wrong-trust-me-they-will" class="level2" data-number="5"><h2 data-number="5" class="anchored" data-anchor-id="when-things-go-wrong-trust-me-they-will">
<span class="header-section-number">5</span> When Things Go Wrong (Trust me, they Will)</h2>
<section id="my-model-wont-converge" class="level3" data-number="5.1"><h3 data-number="5.1" class="anchored" data-anchor-id="my-model-wont-converge">
<span class="header-section-number">5.1</span> “My model won’t converge!”</h3>
<ul>
<li>Check for complete separation in logistic regression</li>
<li>Try scaling your predictors</li>
<li>Check for perfect multicollinearity</li>
<li>Or just accept that your data is cursed</li>
</ul></section><section id="my-coefficients-are-huge" class="level3" data-number="5.2"><h3 data-number="5.2" class="anchored" data-anchor-id="my-coefficients-are-huge">
<span class="header-section-number">5.2</span> “My coefficients are huge!”</h3>
<ul>
<li>You forgot to scale your variables</li>
<li>Or you have a separation issue</li>
<li>Or your data really is that dramatic</li>
</ul></section><section id="the-deviance-is-gigantic" class="level3" data-number="5.3"><h3 data-number="5.3" class="anchored" data-anchor-id="the-deviance-is-gigantic">
<span class="header-section-number">5.3</span> “The deviance is gigantic!”</h3>
<ul>
<li>Maybe your model actually sucks?</li>
<li>Or you have outliers</li>
<li>Check if you’re using the right family</li>
<li>Consider adding interaction terms or polynomial terms</li>
</ul></section><section id="im-getting-warnings-about-fitted-probabilities-of-0-or-1" class="level3" data-number="5.4"><h3 data-number="5.4" class="anchored" data-anchor-id="im-getting-warnings-about-fitted-probabilities-of-0-or-1">
<span class="header-section-number">5.4</span> “I’m getting warnings about fitted probabilities of 0 or 1”</h3>
<ul>
<li>This is actually okay sometimes! It means you have very confident predictions</li>
<li>But if you’re getting tons of these, you might have separation issues</li>
<li>Check your data for extreme values</li>
</ul>
<hr></section></section><section id="final-boss-wisdom" class="level2" data-number="6"><h2 data-number="6" class="anchored" data-anchor-id="final-boss-wisdom">
<span class="header-section-number">6</span> Final Boss Wisdom</h2>
<ul>
<li>Linear regression is a GLM that forgot it was a GLM</li>
<li>The link function is the reason you’re not predicting negative counts</li>
<li>IRLS is just weighted least squares that updates itself until it stops crying</li>
<li>Deviance is RSS for adults</li>
</ul>
<p>Go forth and model responsibly.</p>
</section><section id="some-good-references" class="level2" data-number="7"><h2 data-number="7" class="anchored" data-anchor-id="some-good-references">
<span class="header-section-number">7</span> Some good references</h2>
<ul>
<li>McCullagh &amp; Nelder (1989) – The Bible. Dense. Bring coffee and a therapist.</li>
<li>Dobson &amp; Barnett – Actually readable introduction</li>
<li>Faraway – Practical R examples, minimal pain</li>
<li>Nelder &amp; Wedderburn (1972) – The original paper. Short, brilliant, life-changing</li>
<li>The UCLA stats page on GLMs – Still the best free resource in 2025</li>
</ul>
<p>And remember:</p>
<blockquote class="blockquote">
<p>“All models are wrong. But GLMs are wrong in the most elegant way possible.”</p>
</blockquote>
<p>Now go write some proper models, you beautiful statistician.</p>
</section><section id="appendix-cheat-sheet" class="level2" data-number="8"><h2 data-number="8" class="anchored" data-anchor-id="appendix-cheat-sheet">
<span class="header-section-number">8</span> Appendix — Cheat Sheet</h2>
<p><em>Which GLM Should I Use?</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 22%">
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th>Your Y looks like…</th>
<th>Distribution</th>
<th>Link</th>
<th>R Code</th>
<th>Python Code</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0, 1, 2, 3… (counts)</td>
<td>Poisson</td>
<td>log</td>
<td><code>family = poisson()</code></td>
<td><code>sm.families.Poisson()</code></td>
</tr>
<tr class="even">
<td>Yes/No (binary)</td>
<td>Binomial</td>
<td>logit</td>
<td><code>family = binomial()</code></td>
<td><code>sm.families.Binomial()</code></td>
</tr>
<tr class="odd">
<td>0.2, 0.7, 0.4… (proportions)</td>
<td>Binomial</td>
<td>logit</td>
<td><code>family = binomial()</code></td>
<td><code>sm.families.Binomial()</code></td>
</tr>
<tr class="even">
<td>Always positive, right-skewed</td>
<td>Gamma</td>
<td>log</td>
<td><code>family = Gamma()</code></td>
<td><code>sm.families.Gamma()</code></td>
</tr>
<tr class="odd">
<td>Any real number</td>
<td>Gaussian</td>
<td>identity</td>
<td>
<code>family = gaussian()</code> or <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>
</td>
<td><code>sm.families.Gaussian()</code></td>
</tr>
</tbody>
</table>
<p><em>Oh wait, the overdispersion in count data? R pre-installs <a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a> anyways, so bother use <code>glm.nb()</code> yourself. </em></p>
<p><strong>Pro tip</strong>: When in doubt, plot your residuals. If they look like a crime scene, you chose wrong.</p>


</section></main><!-- /main --><style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

/* Light theme variables */
:root {
  --primary-color: #3b82f6;
  --primary-dark: #2563eb;
  --secondary-color: #64748b;
  --accent-color: #06b6d4;
  --background: #ffffff;
  --surface: #f8fafc;
  --surface-hover: #f1f5f9;
  --surface-light: #e2e8f0;
  --border: #e2e8f0;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --radius: 8px;
  --radius-lg: 12px;
}

/* Dark theme variables */
[data-theme="dark"] {
  --primary-color: #60a5fa;
  --primary-dark: #3b82f6;
  --secondary-color: #94a3b8;
  --accent-color: #22d3ee;
  --background: #0f172a;
  --surface: #1e293b;
  --surface-hover: #334155;
  --surface-light: #475569;
  --border: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.5);
}

/* =========================
   Navbar Theme Fix
   ========================= */

/* Target all navbar elements to use theme colors */
.navbar,
.navbar-default,
.navbar-expand-lg,
nav.navbar,
header.navbar,
#quarto-header,
.quarto-navbar,
nav[role="navigation"] {
  background: var(--background) !important;
  border-bottom: 1px solid var(--border) !important;
  box-shadow: var(--shadow-sm) !important;
}

/* =========================
   Title Block Banner Theme Fix
   ========================= */

/* Target title block banner area */
#title-block-header,
.quarto-title-block,
header#title-block-header,
.quarto-title-banner {
  background: var(--background) !important;
  color: var(--text-primary) !important;
}

/* Title block container */
.quarto-title-block .quarto-title,
#title-block-header .quarto-title {
  background: var(--background) !important;
}

/* =========================
   Listing Controls Theme Fix (Sorter/Filter)
   ========================= */

/* Order By / Sort dropdown and Filter input */
.listing-option-group,
.listing-actions,
.listing-controls,
div[class*="listing"] {
  background: var(--background) !important;
}

/* Dropdowns and inputs in listing controls */
.listing-option-group select,
.listing-option-group input,
#listing-order-by,
select,
input[type="text"],
input[type="search"] {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border) !important;
}

.listing-option-group select:hover,
.listing-option-group input:hover,
select:hover,
input[type="text"]:hover,
input[type="search"]:hover {
  background: var(--surface-hover) !important;
  border-color: var(--primary-color) !important;
}

/* Labels in listing controls */
.listing-option-group label,
.listing-controls label {
  color: var(--text-primary) !important;
}

/* =========================
   Footer Theme Fix
   ========================= */

/* Footer area */
footer,
.footer,
.nav-footer,
.quarto-footer,
body > footer,
#quarto-footer {
  background: var(--surface) !important;
  color: var(--text-secondary) !important;
  border-top: 1px solid var(--border) !important;
}

/* Footer links */
footer a,
.footer a,
.nav-footer a,
.quarto-footer a {
  color: var(--text-secondary) !important;
}

footer a:hover,
.footer a:hover,
.nav-footer a:hover,
.quarto-footer a:hover {
  color: var(--primary-color) !important;
}

/* Footer text */
footer p,
footer div,
.footer p,
.footer div,
.nav-footer p,
.nav-footer div {
  color: var(--text-secondary) !important;
}

/* Navbar brand/logo */
.navbar-brand,
.navbar-title,
a.navbar-brand {
  color: var(--text-primary) !important;
}

/* Navbar links */
.navbar-nav .nav-link,
.navbar .nav-link,
.navbar a,
.nav-link {
  color: var(--text-secondary) !important;
}

.navbar-nav .nav-link:hover,
.navbar .nav-link:hover,
.navbar a:hover,
.nav-link:hover {
  color: var(--primary-color) !important;
}

/* Active navbar link */
.navbar-nav .nav-link.active,
.navbar .nav-link.active,
.nav-link.active {
  color: var(--primary-color) !important;
}

/* Navbar toggler*/
.navbar-toggler {
  border-color: var(--border) !important;
  padding: 0.25rem 0.5rem;
}

.navbar-toggler:focus {
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

/* Create custom hamburger icon that respects theme */
.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(71, 85, 105, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
  display: inline-block;
  width: 1.5em;
  height: 1.5em;
  vertical-align: middle;
}

/* Dark theme hamburger icon */
[data-theme="dark"] .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(203, 213, 225, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
}

/* Search button and icons in navbar */
.navbar .quarto-navbar-tools,
.navbar-nav .nav-item i,
.navbar i {
  color: var(--text-secondary) !important;
}

.navbar .quarto-navbar-tools:hover,
.navbar-nav .nav-item i:hover,
.navbar i:hover {
  color: var(--primary-color) !important;
}

/* Theme toggle button - repositioned to avoid navbar overlap */
.theme-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  background: var(--primary-color);
  color: white;
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.25rem;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background: var(--primary-dark);
  transform: scale(1.1);
  box-shadow: 0 15px 25px -5px rgb(0 0 0 / 0.3);
}

.theme-toggle:active {
  transform: scale(0.95);
}

/* Base styles with smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Remove automatic numbering for headings */
body {
  counter-reset: none;
}

h1::before,
h2::before,
h3::before,
h4::before,
h5::before,
h6::before {
  content: none !important;
}

/* Override any automatic numbering */
.section .header-section-number {
  display: none !important;
}

.header-section-number {
  display: none !important;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  line-height: 1.7;
  color: var(--text-primary);
  background: var(--background);
  margin: 0;
  padding: 0;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Container styling */
.container-fluid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  padding-top: 4rem; 
}

/* Header styling with enhanced animations */
.title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  line-height: 1.2;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: slideInFromTop 0.8s ease-out;
}

.subtitle {
  font-size: 1.25rem;
  color: var(--text-secondary);
  margin-bottom: 2rem;
  font-weight: 400;
  animation: slideInFromTop 0.8s ease-out 0.2s both;
}

.author, .date {
  color: var(--text-muted);
  font-size: 1.325rem;
  margin-bottom: 0.5rem;
  animation: slideInFromTop 0.8s ease-out 0.4s both;
}

/* Animations */
@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* =========================
   Table of Contents
   ========================= */

#TOC {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-sm);
  animation: fadeIn 0.8s ease-out 0.6s both;
}

/* Force all TOC elements to use theme colors */
#TOC,
#TOC ul,
#TOC li,
#TOC div {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
}

/* Hide "on this page" text in TOC - Multiple selectors for compatibility */
body.quarto-post #TOC .toc-title,
#TOC .toc-title,
.toc-title,
#quarto-margin-sidebar .toc-title,
.sidebar nav[role="doc-toc"] > h2,
.sidebar nav[role="doc-toc"] > .h2,
#quarto-margin-sidebar h2,
aside[role="complementary"] h2,
nav[role="doc-toc"] h2 {
  display: none !important;
}

#TOC ul {
  margin: 0;
  padding-left: 1.25rem;
  list-style: none;
  background: var(--surface) !important;
}

#TOC > ul {
  padding-left: 0;
  background: var(--surface) !important;
}

#TOC li {
  margin: 0.5rem 0;
  position: relative;
  transform: translateX(0);
  transition: transform 0.2s ease;
  background: var(--surface) !important;
}

#TOC li:hover {
  transform: translateX(5px);
  background: var(--surface) !important;
}

#TOC li::before {
  content: "→";
  color: var(--primary-color);
  font-weight: bold;
  position: absolute;
  left: -1rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

#TOC li:hover::before {
  opacity: 1;
}

#TOC a {
  color: var(--text-primary) !important;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.2s ease;
  display: block;
  padding: 0.25rem 0;
  border-radius: var(--radius);
  padding-left: 0.5rem;
  background: transparent !important;
}

#TOC a:hover {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Target specific R Markdown TOC structure */
.tocify-wrapper,
.tocify-extend-page {
  background: var(--surface) !important;
}

/* Override any white backgrounds in TOC */
#TOC * {
  background-color: var(--surface) !important;
}

#TOC a * {
  background-color: transparent !important;
}

/* Floating TOC with enhanced styling */
.tocify {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  padding: 1rem;
  backdrop-filter: blur(10px);
}

.tocify-header {
  font-weight: 600;
  color: var(--text-primary) !important;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 0.5rem;
}

.tocify-item {
  padding: 0.25rem 0;
}

.tocify-item a {
  color: var(--text-secondary) !important;
  text-decoration: none;
  transition: all 0.2s ease;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius);
  display: block;
}

.tocify-item a:hover,
.tocify-item.active a {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Headers styling */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  margin-top: 2.5rem;
  margin-bottom: 1rem;
  line-height: 1.3;
  color: var(--text-primary);
}

h1 {
  font-size: 2.25rem;
  border-bottom: 3px solid var(--primary-color);
  padding-bottom: 0.75rem;
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
}

h1::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: -100%;
  right: 100%;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
  animation: shimmer 2s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% {
    left: -100%;
    right: 100%;
  }
  50% {
    left: 0%;
    right: 0%;
  }
}

h2 {
  font-size: 1.875rem;
  color: var(--primary-dark);
  position: relative;
  padding-left: 1rem;
}

h2::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0.25rem;
  bottom: 0.25rem;
  width: 4px;
  background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
  border-radius: 2px;
  transform: scaleY(0);
  transform-origin: top;
  transition: transform 0.3s ease;
}

h2:hover::before {
  transform: scaleY(1);
}

h3 {
  font-size: 1.5rem;
  color: var(--text-primary);
}

h4 {
  font-size: 1.25rem;
  color: var(--secondary-color);
}

/* Interactive code folding button */
.code-folding-btn {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  border: none;
  padding: 0.75rem 1.25rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 600;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
}

.code-folding-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.code-folding-btn:active {
  transform: translateY(0);
}

.code-folding-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.code-folding-btn:hover::after {
  left: 100%;
}

/* =========================
   Callout title
   ========================= */

.callout-title-container {
  color: #19183B !important;
}

/* =========================
   Global hyperlink styling
   ========================= */

/* Global styling - Light mode */
a:not(.quarto-category):not(.listing-category),
a:visited:not(.quarto-category):not(.listing-category) {
  color: #3A6F43 !important;
  text-decoration: none;
}

a:hover:not(.quarto-category):not(.listing-category) {
  color: #333333 !important;
}

/* Dark mode hyperlinks */
[data-theme="dark"] a:not(.quarto-category):not(.listing-category),
[data-theme="dark"] a:visited:not(.quarto-category):not(.listing-category) {
  color: #8BAE66 !important;
}

[data-theme="dark"] a:hover:not(.quarto-category):not(.listing-category) {
  color: #a8cc88 !important;
}

/* =========================
   Category Links Fix
   ========================= */

/* Ensure category links remain functional */
.quarto-category,
a.quarto-category,
.quarto-categories .quarto-category,
.listing-category,
a.listing-category {
  pointer-events: auto !important;
  cursor: pointer !important;
  color: inherit !important;
  text-decoration: none !important;
}

.quarto-category:hover,
.listing-category:hover {
  opacity: 0.8 !important;
  text-decoration: none !important;
}

/* =========================
   Strong Global bold text
   ========================= */

strong, b {
  font-weight: 700;
}

/* Enhanced blockquotes */
blockquote {
  border-left: 4px solid var(--accent-color);
  margin: 1.5rem 0;
  padding: 1rem 1.5rem;
  background: var(--surface);
  border-radius: 0 var(--radius) var(--radius) 0;
  color: var(--text-secondary);
  font-style: italic;
  position: relative;
  box-shadow: var(--shadow-sm);
}

blockquote::before {
  content: """;
  font-size: 3rem;
  color: var(--accent-color);
  position: absolute;
  top: -10px;
  left: 10px;
  opacity: 0.3;
}

/* Smooth scrolling and enhanced focus */
html {
  scroll-behavior: smooth;
}

/* Selection styling */
::selection {
  background: var(--primary-color);
  color: white;
}

::-moz-selection {
  background: var(--primary-color);
  color: white;
}

/* Enhanced focus styles */
button:focus,
a:focus,
input:focus,
textarea:focus {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
  border-radius: var(--radius);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: var(--surface);
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 6px;
  border: 2px solid var(--surface);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--secondary-color);
}

/* Responsive design */
@media (max-width: 768px) {
  .theme-toggle {
    bottom: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
    font-size: 1.1rem;
  }
  
  .container-fluid {
    padding: 1rem;
    padding-top: 3rem;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .subtitle {
    font-size: 1.725rem;
  }
  
  h1 {
    font-size: 1.875rem;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  pre {
    padding: 1rem;
  }
  
  pre code {
    font-size: 0.9rem;
  }
}

/* Print styles */
@media print {
  .theme-toggle {
    display: none;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.5;
    color: black;
    background: white;
  }
  
  .title {
    color: black;
    -webkit-text-fill-color: black;
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: black;
    page-break-after: avoid;
  }
  
  pre, blockquote {
    page-break-inside: avoid;
  }
  
  .tocify {
    display: none;
  }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.createElement('button');
  themeToggle.className = 'theme-toggle';
  themeToggle.innerHTML = '🌙';
  themeToggle.setAttribute('aria-label', 'Toggle dark mode');
  themeToggle.setAttribute('title', 'Toggle dark/light mode');
  
  document.body.appendChild(themeToggle);
  
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  themeToggle.innerHTML = savedTheme === 'dark' ? '🌙' : '☀️';
  
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    themeToggle.innerHTML = newTheme === 'dark' ? '🌙' : '☀️';
    
    themeToggle.style.transform = 'rotate(360deg)';
    setTimeout(() => {
      themeToggle.style.transform = 'rotate(0deg)';
    }, 300);
  });
  
  setTimeout(function() {
    const tocTitles = document.querySelectorAll('.toc-title, #quarto-margin-sidebar h2, nav[role="doc-toc"] h2');
    tocTitles.forEach(function(title) {
      title.style.display = 'none';
    });
  }, 100);
  
  const tocLinks = document.querySelectorAll('#TOC a, .tocify a');
  tocLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });
  
  const images = document.querySelectorAll('img');
  images.forEach(function(img) {
    if (img.complete) {
      img.style.opacity = '1';
    } else {
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.5s ease';
      
      img.addEventListener('load', function() {
        this.style.opacity = '1';
      });
    }
  });
});
</script><style>
    /* Modal Styles */
    .code-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    .code-modal-content {
        position: relative;
        background-color: #fff;
        margin: 5% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 1200px;
        max-height: 80vh;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .code-modal-header {
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
    }

    .code-modal-title {
        font-size: 1.2em;
        font-weight: 600;
        margin: 0;
    }

    .code-modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }

    .code-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .code-modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #f8f9fa;
    }

    .code-modal-section {
        margin-bottom: 20px;
    }

    .code-modal-section:last-child {
        margin-bottom: 0;
    }

    .code-modal-section h3 {
        margin: 0 0 10px 0;
        font-size: 1.1em;
        color: #333;
        padding-bottom: 5px;
        border-bottom: 2px solid #1e3a8a;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .code-modal-code {
        background-color: #0f172a;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        overflow-x: auto;
        white-space: pre;
        margin: 0;
    }

    .code-modal-output {
        background-color: #fff;
        border: 1px solid #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        white-space: pre-wrap;
        margin: 0;
        color: #2d3748;
    }

    /* Button to open modal */
    .code-open-btn {
        background: #0f172a;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85em;
        font-weight: 500;
        margin: 5px 0;
        transition: all 0.3s ease;
    }

    .code-open-btn:hover {
        background: #1e293b;
        transform: translateY(-1px);
    }

    /* Copy button styles */
    .copy-btn {
        background: #1e3a8a;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.75em;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s ease;
    }

    .copy-btn:hover {
        background: #1e40af;
    }

    .copy-btn.copied {
        background: #059669;
    }

    .copy-icon {
        width: 14px;
        height: 14px;
        fill: currentColor;
    }

    /* Hide original code blocks that have code-open */
    .cell[data-code-open="true"] .sourceCode {
        display: none;
    }

    .cell[data-code-open="true"] .cell-output {
        display: none;
    }

    /* Animation */
    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .code-modal.show .code-modal-content {
        animation: modalFadeIn 0.3s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .code-modal-content {
            width: 95%;
            margin: 2% auto;
            max-height: 90vh;
        }

        .code-modal-header {
            padding: 10px 15px;
        }

        .code-modal-body {
            padding: 15px;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to create modal
        function createModal() {
            const modal = document.createElement('div');
            modal.className = 'code-modal';
            document.body.appendChild(modal);
            return modal;
        }

        // Create the modal
        const modal = createModal();
        const modalContent = modal.querySelector('.code-modal-content');
        const closeBtn = modal.querySelector('.code-modal-close');
        const codeElement = modal.querySelector('.code-modal-code');
        const outputElement = modal.querySelector('.code-modal-output');

        // Function to open modal
        function openModal(codeText, outputText, title = 'Code & Output') {
            modal.querySelector('.code-modal-title').textContent = title;
            codeElement.textContent = codeText;
            outputElement.textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }

        // Function to close modal
        function closeModal() {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        // Event listeners for modal
        closeBtn.addEventListener('click', closeModal);

        // Copy functionality
        const copyCodeBtn = modal.querySelector('#copy-code-btn');
        const copyOutputBtn = modal.querySelector('#copy-output-btn');

        copyCodeBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(codeElement.textContent);
                copyCodeBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyCodeBtn.classList.add('copied');
                setTimeout(() => {
                    copyCodeBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyCodeBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy code:', err);
            }
        });

        copyOutputBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(outputElement.textContent);
                copyOutputBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyOutputBtn.classList.add('copied');
                setTimeout(() => {
                    copyOutputBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyOutputBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy output:', err);
            }
        });

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        // Function to extract title from Quarto cell metadata
        function extractTitleFromCell(cell) {
            // Look for code-modal-title in various places
            let title = null;

            // 1. Check for data attribute on the cell
            if (cell.hasAttribute('data-code-modal-title')) {
                title = cell.getAttribute('data-code-modal-title');
            }

            // 2. Check for code-modal-title in cell options (Quarto metadata)
            const cellOptions = cell.querySelector('.cell-meta, .cell-code-meta');
            if (cellOptions && !title) {
                const optionsText = cellOptions.textContent;
                const titleMatch = optionsText.match(/code-modal-title:\s*["']([^"']+)["']/);
                if (titleMatch) {
                    title = titleMatch[1];
                }
            }

            // 3. Look for title in HTML comments (Quarto sometimes puts metadata there)
            const htmlContent = cell.innerHTML;
            const commentMatch = htmlContent.match(/<!--.*?code-modal-title:\s*["']([^"']+)["'].*?-->/s);
            if (commentMatch && !title) {
                title = commentMatch[1];
            }

            // 4. Look for title in the cell's script tags or data attributes
            const scripts = cell.querySelectorAll('script[type="application/json"]');
            scripts.forEach(script => {
                if (!title) {
                    try {
                        const data = JSON.parse(script.textContent);
                        if (data['code-modal-title']) {
                            title = data['code-modal-title'];
                        }
                    } catch (e) {
                        // Ignore JSON parse errors
                    }
                }
            });

            // 5. Look in the raw text content for the pattern
            if (!title) {
                const rawText = cell.textContent;
                const rawMatch = rawText.match(/code-modal-title:\s*["']?([^"'\n]+)["']?/);
                if (rawMatch) {
                    title = rawMatch[1].trim().replace(/["']/g, '');
                }
            }

            // 6. Alternative pattern matching for YAML-like syntax
            if (!title) {
                const yamlMatch = htmlContent.match(/code-modal-title:\s*(.+)/);
                if (yamlMatch) {
                    title = yamlMatch[1].trim().replace(/["']/g, '');
                }
            }

            return title;
        }

        // Function to process code blocks with code-open attribute
        function processCodeOpenBlocks() {
            // Look for cells with code-open attribute in Quarto
            const cells = document.querySelectorAll('.cell');

            cells.forEach((cell, index) => {
                // Skip if already processed
                if (cell.hasAttribute('data-processed')) return;

                // Check if this cell should have code-open functionality
                const hasCodeOpen = cell.querySelector('[data-code-open="true"]') ||
                    cell.hasAttribute('data-code-open') ||
                    cell.innerHTML.includes('code-open: true') ||
                    cell.textContent.includes('code-open: true');

                if (hasCodeOpen) {
                    // Mark the cell as processed
                    cell.setAttribute('data-code-open', 'true');
                    cell.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(cell);

                    // Find source code
                    const sourceCode = cell.querySelector('.sourceCode code, pre code, .r code');
                    const codeText = sourceCode ? sourceCode.textContent : '';

                    // Find output
                    const outputElements = cell.querySelectorAll('.cell-output pre, .cell-output .output');
                    let outputText = '';
                    outputElements.forEach(output => {
                        outputText += output.textContent + '\n';
                    });

                    // Create open button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        // Use custom title if available, otherwise default
                        const title = customTitle || `Code Block ${index + 1}`;
                        openModal(codeText, outputText.trim(), title);
                    });

                    // Insert button at the beginning of the cell
                    cell.insertBefore(openBtn, cell.firstChild);
                }
            });
        }

        // Alternative approach for direct code blocks
        function processDirectCodeBlocks() {
            const codeBlocks = document.querySelectorAll('pre code');

            codeBlocks.forEach(code => {
                const preElement = code.parentElement;
                const container = preElement.parentElement;

                // Skip if already processed
                if (container.hasAttribute('data-processed')) return;

                // Check for code-open in various ways
                if (container.hasAttribute('data-code-open') ||
                    container.classList.contains('code-open') ||
                    preElement.hasAttribute('data-code-open') ||
                    container.innerHTML.includes('code-open: true')) {

                    // Mark as processed
                    container.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(container);

                    const codeText = code.textContent;

                    // Look for adjacent output
                    let outputText = '';
                    let nextElement = container.nextElementSibling;
                    if (nextElement && (nextElement.tagName === 'PRE' || nextElement.classList.contains('output'))) {
                        outputText = nextElement.textContent;
                    }

                    // Create and insert button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        const title = customTitle || 'Code Block';
                        openModal(codeText, outputText, title);
                    });

                    // Hide original and add button
                    container.style.display = 'none';
                    if (nextElement && outputText) {
                        nextElement.style.display = 'none';
                    }

                    container.parentElement.insertBefore(openBtn, container);
                }
            });
        }

        // Run processing functions
        processCodeOpenBlocks();
        processDirectCodeBlocks();

        // Also run after a short delay to catch dynamically loaded content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 1000);

        // Run again after a longer delay for slow-loading content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 3000);
    });

    // Manual function to add code-open functionality
    function addCodeOpen(codeElement, outputElement, title) {
        const openBtn = document.createElement('button');
        openBtn.className = 'code-open-btn';
        openBtn.textContent = 'View Code & Output';

        openBtn.addEventListener('click', function() {
            const codeText = codeElement.textContent;
            const outputText = outputElement ? outputElement.textContent : '';

            // Trigger the modal (assuming the modal is already created)
            const modal = document.querySelector('.code-modal');
            if (modal) {
                const event = new CustomEvent('openCodeModal', {
                    detail: { codeText, outputText, title }
                });
                document.dispatchEvent(event);
            }
        });

        return openBtn;
    }

    // Listen for custom events
    document.addEventListener('openCodeModal', function(e) {
        const { codeText, outputText, title } = e.detail;
        const modal = document.querySelector('.code-modal');
        if (modal) {
            modal.querySelector('.code-modal-title').textContent = title || 'Code & Output';
            modal.querySelector('.code-modal-code').textContent = codeText;
            modal.querySelector('.code-modal-output').textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }
    });
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/joshuamarie\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><script src="https://utteranc.es/client.js" repo="joshuamarie/joshuamarie.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Design inspired by <a href="https://github.com/statichunt/geeky-hugo">Geeky Hugo</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/edit/main/posts/07-glm/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>