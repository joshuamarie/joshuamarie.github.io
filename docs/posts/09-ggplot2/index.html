<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Joshua Marie">
<meta name="dcterms.date" content="2025-12-01">
<meta name="description" content="Here are some things I enumerated — things you may or may not know already">
<title>Things you may or you may not know in ggplot2 – Joshua Marie</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/jm-favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0a95de2c3be981c2e03029825b16c585.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-4f90e7b736d88b8ae6544ef5f78d50a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/all.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="../../site_libs/d3-bundle-5.16.0/d3-bundle.min.js"></script><script src="../../site_libs/d3-lasso-0.0.5/d3-lasso.min.js"></script><script src="../../site_libs/save-svg-as-png-1.4.17/save-svg-as-png.min.js"></script><script src="../../site_libs/flatbush-4.4.0/flatbush.min.js"></script><link href="../../site_libs/ggiraphjs-0.8.10/ggiraphjs.min.css" rel="stylesheet">
<script src="../../site_libs/ggiraphjs-0.8.10/ggiraphjs.min.js"></script><script src="../../site_libs/girafe-binding-0.9.1/girafe.js"></script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9842567530621468" crossorigin="anonymous"></script><link rel="stylesheet" href="../../styles/base.css">
<link rel="stylesheet" href="../../styles/layout.css">
<link rel="stylesheet" href="../../styles/hero.css">
<link rel="stylesheet" href="../../styles/cards.css">
<link rel="stylesheet" href="../../styles/about.css">
<link rel="stylesheet" href="../../styles/dark-mode.css">
<link rel="stylesheet" href="../Theme/code.css">
<link rel="stylesheet" href="../Theme/table.css">
<meta name="twitter:title" content="Things you may or you may not know in ggplot2 – Joshua Marie">
<meta name="twitter:description" content="Here are some things I enumerated — things you may or may not know already">
<meta name="twitter:image" content="https://joshuamarie.com/posts/09-ggplot2/image.png">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joshua Marie</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../services.html"> 
<span class="menu-text">Services</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contacts.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">My resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joshuamarie"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joshuamarie/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joshua.marie.k@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS Feed">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Things you may or you may not know in ggplot2</h1>
            <p class="subtitle lead">A rare case study — Some investigations I made</p>
                  <div>
        <div class="description">
          Here are some things I enumerated — things you may or may not know already
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">ggplot2</div>
                <div class="quarto-category">data-science</div>
                <div class="quarto-category">visualization</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">viz</div>
                <div class="quarto-category">programming</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joshua Marie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 1, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#brief-introduction" id="toc-brief-introduction" class="nav-link active" data-scroll-target="#brief-introduction"><span class="header-section-number">1</span> Brief Introduction</a></li>
  <li><a href="#starting-from-4.0.0-s7-is-the-new-imported-oo-system" id="toc-starting-from-4.0.0-s7-is-the-new-imported-oo-system" class="nav-link" data-scroll-target="#starting-from-4.0.0-s7-is-the-new-imported-oo-system"><span class="header-section-number">2</span> 1. Starting from 4.0.0, S7 is the new imported OO system</a></li>
  <li><a href="#it-has-its-own-oo-system-ggproto" id="toc-it-has-its-own-oo-system-ggproto" class="nav-link" data-scroll-target="#it-has-its-own-oo-system-ggproto"><span class="header-section-number">3</span> 2. It has its own OO system: ggproto</a></li>
  <li><a href="#it-has-5-ggplot2-based-interactive-viz" id="toc-it-has-5-ggplot2-based-interactive-viz" class="nav-link" data-scroll-target="#it-has-5-ggplot2-based-interactive-viz"><span class="header-section-number">4</span> 3. It has 5 ggplot2-based interactive viz</a></li>
  <li><a href="#customized-fonts" id="toc-customized-fonts" class="nav-link" data-scroll-target="#customized-fonts"><span class="header-section-number">5</span> 4. Customized fonts</a></li>
  <li><a href="#ggplot2-works-perfectly-without-a-data-frame" id="toc-ggplot2-works-perfectly-without-a-data-frame" class="nav-link" data-scroll-target="#ggplot2-works-perfectly-without-a-data-frame"><span class="header-section-number">6</span> 5. ggplot2 works perfectly without a data frame</a></li>
  <li><a href="#the-art-of-delay" id="toc-the-art-of-delay" class="nav-link" data-scroll-target="#the-art-of-delay"><span class="header-section-number">7</span> 6. The art of delay</a></li>
  <li><a href="#markdown-within-ggplot2-text-elements" id="toc-markdown-within-ggplot2-text-elements" class="nav-link" data-scroll-target="#markdown-within-ggplot2-text-elements"><span class="header-section-number">8</span> 7. Markdown within {ggplot2} text elements</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">9</span> Resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/joshuamarie/joshuamarie/edit/main/posts/09-ggplot2/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="page-columns page-rows-contents page-layout-article"><div class="social-share">
<a href="https://twitter.com/share?url=https://joshuamarie.com/posts/09-ggplot2&amp;text=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://joshuamarie.com/posts/09-ggplot2&amp;title=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie&amp;body=Check%20out%20this%20link:https://joshuamarie.com/posts/09-ggplot2" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://joshuamarie.com/posts/09-ggplot2" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://joshuamarie.com/posts/09-ggplot2&amp;title=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://joshuamarie.com/posts/09-ggplot2&amp;title=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://joshuamarie.com/posts/09-ggplot2&amp;name=Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a><a href="javascript:void(0);" onclick="var mastodon_instance=prompt('Mastodon Instance / Server Name?'); if(typeof mastodon_instance==='string' &amp;&amp; mastodon_instance.length){this.href='https://'+mastodon_instance+'/share?text=Things you may or you may not know in ggplot2 — Joshua Marie https://joshuamarie.com/posts/09-ggplot2'}else{return false;}" target="_blank" class="mastodon"><i class="fa-brands fa-mastodon fa-fw fa-lg"></i></a><a href="https://bsky.app/intent/compose?text=https://joshuamarie.com/posts/09-ggplot2%20Things%20you%20may%20or%20you%20may%20not%20know%20in%20ggplot2%20%E2%80%94%20Joshua%20Marie" target="_blank" class="bsky"><i class="fa-brands fa-bluesky"></i></a>
</div></div>


<section id="brief-introduction" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Brief Introduction</h1>
<p>The <a href="https://ggplot2.tidyverse.org">ggplot2</a> package is now over 18 years old (released way back in 2007) and has 2.2 million downloads per month, based on cranlogs. Thank you Hadley Wickham and co. for adapting “The Grammar of Graphics” by Leland Wilkinson into R programming language.</p>
<p>The things to be enumerated here are some brand new features and some hidden in plain sight. Here are my compilations of things you may or you may not know in <a href="https://ggplot2.tidyverse.org">ggplot2</a>. But first, let us load the package through <a href="https://klmr.me/box/">box</a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">ggplot2</span><span class="op">[</span><span class="va">...</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="starting-from-4.0.0-s7-is-the-new-imported-oo-system" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> 1. Starting from 4.0.0, S7 is the new imported OO system</h1>
<p>The 4.0.0 release of <a href="https://ggplot2.tidyverse.org">ggplot2</a> is now on CRAN few months ago (followed by 4.0.1 — published 18 days ago on November 14, 2025). This release introduces several significant updates, including a major internal shift: <a href="https://ggplot2.tidyverse.org">ggplot2</a> now imports the S7 object-oriented system, a new OO system, developed by the Object-Oriented Programming Working Group, R Consortium.</p>
<p>With this transition, several core internal objects, such as <code>ggplot()</code> and <code>layer()</code>, are now implemented using S7. However, the public-facing API remains largely S3-based, meaning that most users will experience the package exactly as before, with no changes required in existing code.</p>
<div class="cell" data-output-fold="true" data-output-summary="Check out its class">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<details><summary>Check out its class</summary><div class="cell-output cell-output-stdout">
<pre><code>[1] "ggplot2::ggplot" "ggplot"          "ggplot2::gg"     "S7_object"      
[5] "gg"             </code></pre>
</div>
</details>
</div>
<p>If you’re upgrading old projects, expect a few things to break (especially if you relied on internal structure). Lock your version with <a href="https://rstudio.github.io/renv/">renv</a> or <a href="https://groundhogr.com/">groundhog</a> until you’re ready.</p>
<p>This move to S7 represents the most substantial internal redesign of ggplot2 since the introduction of <code>ggproto</code> in 2015.</p>
</section><section id="it-has-its-own-oo-system-ggproto" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> 2. It has its own OO system: ggproto</h1>
<p>Even with the latest 4.0.0 release, the actual layers, scales, coords, etc. are still held by <code>ggproto</code> objects. This is what makes ggplot2 so extensible. This OO system allows reference semantics and inheritance method — a classic OO programming scheme.</p>
<div class="cell" data-output-fold="true" data-output-summary="Check out its class">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/Geom.html">GeomPoint</a></span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<details><summary>Check out its class</summary><div class="cell-output cell-output-stdout">
<pre><code>[1] "GeomPoint" "Geom"      "ggproto"   "gg"       </code></pre>
</div>
</details>
</div>
<p>Wanna know how <code>geom_smooth()</code> secretly uses loess or gam? Just look at <a href="https://github.com/tidyverse/ggplot2/blob/bc605b69de8f0e3e2fb2e510a9c398b5a948146f/R/stat-smooth.R"><code>ggplot2:::StatSmooth$compute_group</code></a>.</p>
</section><section id="it-has-5-ggplot2-based-interactive-viz" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> 3. It has 5 ggplot2-based interactive viz</h1>
<p>There are R packages that makes <a href="https://ggplot2.tidyverse.org">ggplot2</a> interactive, at least several:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 44%">
<col style="width: 26%">
<col style="width: 15%">
</colgroup>
<thead><tr class="header">
<th>Package</th>
<th>Strength</th>
<th>Fidelity to static ggplot</th>
<th>Learning curve (verdict)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>plotly</td>
<td>Dynamic and one-liner using <code>ggplotly()</code>
</td>
<td>Medium (some features lost)</td>
<td>Low (1 star / easy to use)</td>
</tr>
<tr class="even">
<td>ggiraph</td>
<td>Giving full control over tooltip / hover / click</td>
<td>Perfect</td>
<td>Very High (4 stars / difficult for non-native ggplot2 users)</td>
</tr>
<tr class="odd">
<td>ggiraphExtra</td>
<td>Shiny-integrated version of ggiraph</td>
<td>High</td>
<td>Fairly Low (2 stars / quick interactive)</td>
</tr>
<tr class="even">
<td>gginteractive</td>
<td>Minimal code changes, HTMLwidget backend</td>
<td>High</td>
<td>Fairly Low (2 stars / not actively maintained)</td>
</tr>
<tr class="odd">
<td>ggvis (now a legacy)</td>
<td>Once the future, now archived</td>
<td>NULL (I don’t use it)</td>
<td>NULL (I don’t use it)</td>
</tr>
<tr class="even">
<td>vegafacet (2025)</td>
<td>Vega-Lite</td>
<td>Fairly Low (not even ggplot2, but close)</td>
<td>Seriously high (5 stars / still new)</td>
</tr>
</tbody>
</table>
<p>A quick showcase of <a href="https://davidgohel.github.io/ggiraph/">ggiraph</a>:</p>
<div class="cell">
<details class="code-fold"><summary>Click to see the code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">ggiraph</span><span class="op">[</span><span class="va">geom_point_interactive</span>, <span class="va">girafe</span>, <span class="va">opts_hover</span>, <span class="va">opts_hover_inv</span><span class="op">]</span>, </span>
<span>    <span class="va">tibble</span><span class="op">[</span><span class="va">rownames_to_column</span><span class="op">]</span>, </span>
<span>    <span class="va">glue</span><span class="op">[</span><span class="va">glue</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">=</span> </span>
<span>    <span class="va">mtcars</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">rownames_to_column</span><span class="op">(</span>var <span class="op">=</span> <span class="st">"car"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">wt</span>, <span class="va">mpg</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point_interactive</span><span class="op">(</span></span>
<span>        <span class="fu">aes</span><span class="op">(</span></span>
<span>            tooltip <span class="op">=</span> <span class="fu">glue</span><span class="op">(</span><span class="st">"{car} (wt: {wt}; mpg: {mpg})"</span><span class="op">)</span>, </span>
<span>            data_id <span class="op">=</span> <span class="va">car</span></span>
<span>        <span class="op">)</span>, </span>
<span>        size <span class="op">=</span> <span class="fl">4</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">girafe</span><span class="op">(</span></span>
<span>    ggobj <span class="op">=</span> <span class="va">p</span>,</span>
<span>    width_svg <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    height_svg <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="fu">opts_hover</span><span class="op">(</span>css <span class="op">=</span> <span class="st">"fill:yellow;stroke:black;stroke-width:2;cursor:pointer;"</span><span class="op">)</span>,</span>
<span>        <span class="fu">opts_hover_inv</span><span class="op">(</span>css <span class="op">=</span> <span class="st">"opacity:0.3;"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="girafe html-widget html-fill-item" id="htmlwidget-2ae48c6492a0fb7ffaf3" style="width:100%;height:390px;"></div>
<script type="application/json" data-for="htmlwidget-2ae48c6492a0fb7ffaf3">{"x":{"html":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' class='ggiraph-svg' role='graphics-document' id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3' viewBox='0 0 720 432'>\n <defs id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_defs'>\n  <clipPath id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_c1'>\n   <rect x='0' y='0' width='720' height='432'/>\n  <\/clipPath>\n  <clipPath id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_c2'>\n   <rect x='42.15' y='6.97' width='581.56' height='384.95'/>\n  <\/clipPath>\n <\/defs>\n <g id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_rootg' class='ggiraph-svg-rootg'>\n  <g clip-path='url(#svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_c1)'>\n   <rect x='0' y='0' width='720' height='432' fill='#FFFFFF' fill-opacity='1' stroke='#FFFFFF' stroke-opacity='1' stroke-width='0.75' stroke-linejoin='round' stroke-linecap='round' class='ggiraph-svg-bg'/>\n   <rect x='0' y='0' width='720' height='432' fill='#FFFFFF' fill-opacity='1' stroke='none'/>\n  <\/g>\n  <g clip-path='url(#svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_c2)'>\n   <polyline points='42.15,343.16 623.71,343.16' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,268.70 623.71,268.70' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,194.24 623.71,194.24' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,119.78 623.71,119.78' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,45.32 623.71,45.32' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='66.82,391.93 66.82,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='202.00,391.93 202.00,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='337.18,391.93 337.18,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='472.37,391.93 472.37,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='607.55,391.93 607.55,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='0.68' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,380.39 623.71,380.39' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,305.93 623.71,305.93' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,231.47 623.71,231.47' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,157.01 623.71,157.01' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,82.55 623.71,82.55' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='42.15,8.09 623.71,8.09' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='134.41,391.93 134.41,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='269.59,391.93 269.59,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='404.78,391.93 404.78,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <polyline points='539.96,391.93 539.96,6.97' fill='none' stroke='#EBEBEB' stroke-opacity='1' stroke-width='1.36' stroke-linejoin='round' stroke-linecap='butt'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e1' cx='218.23' cy='216.58' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Mazda RX4 (wt: 2.62; mpg: 21)' data-id='Mazda RX4'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e2' cx='252.7' cy='216.58' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Mazda RX4 Wag (wt: 2.875; mpg: 21)' data-id='Mazda RX4 Wag'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e3' cx='177.67' cy='189.77' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Datsun 710 (wt: 2.32; mpg: 22.8)' data-id='Datsun 710'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e4' cx='298.66' cy='210.62' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Hornet 4 Drive (wt: 3.215; mpg: 21.4)' data-id='Hornet 4 Drive'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e5' cx='329.07' cy='250.83' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Hornet Sportabout (wt: 3.44; mpg: 18.7)' data-id='Hornet Sportabout'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e6' cx='331.78' cy='259.76' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Valiant (wt: 3.46; mpg: 18.1)' data-id='Valiant'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e7' cx='346.65' cy='316.35' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Duster 360 (wt: 3.57; mpg: 14.3)' data-id='Duster 360'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e8' cx='295.28' cy='165.94' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 240D (wt: 3.19; mpg: 24.4)' data-id='Merc 240D'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e9' cx='289.87' cy='189.77' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 230 (wt: 3.15; mpg: 22.8)' data-id='Merc 230'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e10' cx='329.07' cy='243.38' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 280 (wt: 3.44; mpg: 19.2)' data-id='Merc 280'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e11' cx='329.07' cy='264.23' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 280C (wt: 3.44; mpg: 17.8)' data-id='Merc 280C'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e12' cx='414.24' cy='285.08' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 450SE (wt: 4.07; mpg: 16.4)' data-id='Merc 450SE'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e13' cx='368.28' cy='271.68' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 450SL (wt: 3.73; mpg: 17.3)' data-id='Merc 450SL'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e14' cx='375.04' cy='302.95' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Merc 450SLC (wt: 3.78; mpg: 15.2)' data-id='Merc 450SLC'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e15' cx='573.75' cy='374.43' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Cadillac Fleetwood (wt: 5.25; mpg: 10.4)' data-id='Cadillac Fleetwood'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e16' cx='597.27' cy='374.43' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Lincoln Continental (wt: 5.424; mpg: 10.4)' data-id='Lincoln Continental'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e17' cx='586.59' cy='310.39' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Chrysler Imperial (wt: 5.345; mpg: 14.7)' data-id='Chrysler Imperial'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e18' cx='161.45' cy='46.81' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Fiat 128 (wt: 2.2; mpg: 32.4)' data-id='Fiat 128'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e19' cx='82.37' cy='76.59' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Honda Civic (wt: 1.615; mpg: 30.4)' data-id='Honda Civic'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e20' cx='112.11' cy='24.47' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Toyota Corolla (wt: 1.835; mpg: 33.9)' data-id='Toyota Corolla'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e21' cx='197.27' cy='209.13' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Toyota Corona (wt: 2.465; mpg: 21.5)' data-id='Toyota Corona'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e22' cx='339.89' cy='298.48' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Dodge Challenger (wt: 3.52; mpg: 15.5)' data-id='Dodge Challenger'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e23' cx='328.4' cy='302.95' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='AMC Javelin (wt: 3.435; mpg: 15.2)' data-id='AMC Javelin'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e24' cx='383.15' cy='331.24' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Camaro Z28 (wt: 3.84; mpg: 13.3)' data-id='Camaro Z28'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e25' cx='383.82' cy='243.38' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Pontiac Firebird (wt: 3.845; mpg: 19.2)' data-id='Pontiac Firebird'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e26' cx='125.63' cy='122.76' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Fiat X1-9 (wt: 1.935; mpg: 27.3)' data-id='Fiat X1-9'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e27' cx='153.34' cy='142.12' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Porsche 914-2 (wt: 2.14; mpg: 26)' data-id='Porsche 914-2'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e28' cx='68.58' cy='76.59' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Lotus Europa (wt: 1.513; mpg: 30.4)' data-id='Lotus Europa'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e29' cx='292.58' cy='294.01' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Ford Pantera L (wt: 3.17; mpg: 15.8)' data-id='Ford Pantera L'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e30' cx='238.5' cy='235.94' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Ferrari Dino (wt: 2.77; mpg: 19.7)' data-id='Ferrari Dino'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e31' cx='346.65' cy='305.93' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Maserati Bora (wt: 3.57; mpg: 15)' data-id='Maserati Bora'/>\n   <circle id='svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_e32' cx='239.85' cy='210.62' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round' title='Volvo 142E (wt: 2.78; mpg: 21.4)' data-id='Volvo 142E'/>\n  <\/g>\n  <g clip-path='url(#svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3_c1)'>\n   <text x='23.43' y='384.39' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>10<\/text>\n   <text x='23.43' y='309.93' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>15<\/text>\n   <text x='23.43' y='235.47' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>20<\/text>\n   <text x='23.43' y='161.02' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>25<\/text>\n   <text x='23.43' y='86.56' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>30<\/text>\n   <text x='23.43' y='12.1' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>35<\/text>\n   <text x='131.3' y='406.22' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>2<\/text>\n   <text x='266.48' y='406.22' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>3<\/text>\n   <text x='401.67' y='406.22' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>4<\/text>\n   <text x='536.85' y='406.22' font-size='8.4pt' font-family='Arial' fill='#4D4D4D' fill-opacity='1'>5<\/text>\n   <text x='325.93' y='422.08' font-size='10.5pt' font-family='Arial'>wt<\/text>\n   <text transform='translate(17.00,213.06) rotate(-90.00)' font-size='10.5pt' font-family='Arial'>mpg<\/text>\n   <text x='644.63' y='175.05' font-size='10.5pt' font-family='Arial'>factor(cyl)<\/text>\n   <circle cx='653.27' cy='192.14' r='3.54pt' fill='#F8766D' fill-opacity='1' stroke='#F8766D' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round'/>\n   <circle cx='653.27' cy='209.42' r='3.54pt' fill='#00BA38' fill-opacity='1' stroke='#00BA38' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round'/>\n   <circle cx='653.27' cy='226.7' r='3.54pt' fill='#619CFF' fill-opacity='1' stroke='#619CFF' stroke-opacity='1' stroke-width='0.9' stroke-linejoin='round' stroke-linecap='round'/>\n   <text x='668.88' y='196.15' font-size='8.4pt' font-family='Arial'>4<\/text>\n   <text x='668.88' y='213.43' font-size='8.4pt' font-family='Arial'>6<\/text>\n   <text x='668.88' y='230.71' font-size='8.4pt' font-family='Arial'>8<\/text>\n  <\/g>\n <\/g>\n<\/svg>","js":null,"uid":"svg_d5558f8e_c9de_4afa_b9db_e79df4d22ac3","ratio":1.666666666666667,"settings":{"tooltip":{"css":".tooltip_SVGID_ { padding:5px;background:black;color:white;border-radius:2px;text-align:left; ; position:absolute;pointer-events:none;z-index:999;}","placement":"doc","opacity":0.9,"offx":10,"offy":10,"use_cursor_pos":true,"use_fill":false,"use_stroke":false,"delay_over":200,"delay_out":500},"hover":{"css":".hover_data_SVGID_ { fill:yellow;stroke:black;stroke-width:2;cursor:pointer; }","reactive":false,"nearest_distance":null},"hover_inv":{"css":".hover_inv_SVGID_ { opacity:0.3; }"},"hover_key":{"css":".hover_key_SVGID_ { fill:orange;stroke:black;cursor:pointer; }\ntext.hover_key_SVGID_ { stroke:none;fill:orange; }\ncircle.hover_key_SVGID_ { fill:orange;stroke:black; }\nline.hover_key_SVGID_, polyline.hover_key_SVGID_ { fill:none;stroke:orange; }\nrect.hover_key_SVGID_, polygon.hover_key_SVGID_, path.hover_key_SVGID_ { fill:orange;stroke:none; }\nimage.hover_key_SVGID_ { stroke:orange; }","reactive":true},"hover_theme":{"css":".hover_theme_SVGID_ { fill:orange;stroke:black;cursor:pointer; }\ntext.hover_theme_SVGID_ { stroke:none;fill:orange; }\ncircle.hover_theme_SVGID_ { fill:orange;stroke:black; }\nline.hover_theme_SVGID_, polyline.hover_theme_SVGID_ { fill:none;stroke:orange; }\nrect.hover_theme_SVGID_, polygon.hover_theme_SVGID_, path.hover_theme_SVGID_ { fill:orange;stroke:none; }\nimage.hover_theme_SVGID_ { stroke:orange; }","reactive":true},"select":{"css":".select_data_SVGID_ { fill:red;stroke:black;cursor:pointer; }\ntext.select_data_SVGID_ { stroke:none;fill:red; }\ncircle.select_data_SVGID_ { fill:red;stroke:black; }\nline.select_data_SVGID_, polyline.select_data_SVGID_ { fill:none;stroke:red; }\nrect.select_data_SVGID_, polygon.select_data_SVGID_, path.select_data_SVGID_ { fill:red;stroke:none; }\nimage.select_data_SVGID_ { stroke:red; }","type":"multiple","only_shiny":true,"selected":[]},"select_inv":{"css":""},"select_key":{"css":".select_key_SVGID_ { fill:red;stroke:black;cursor:pointer; }\ntext.select_key_SVGID_ { stroke:none;fill:red; }\ncircle.select_key_SVGID_ { fill:red;stroke:black; }\nline.select_key_SVGID_, polyline.select_key_SVGID_ { fill:none;stroke:red; }\nrect.select_key_SVGID_, polygon.select_key_SVGID_, path.select_key_SVGID_ { fill:red;stroke:none; }\nimage.select_key_SVGID_ { stroke:red; }","type":"single","only_shiny":true,"selected":[]},"select_theme":{"css":".select_theme_SVGID_ { fill:red;stroke:black;cursor:pointer; }\ntext.select_theme_SVGID_ { stroke:none;fill:red; }\ncircle.select_theme_SVGID_ { fill:red;stroke:black; }\nline.select_theme_SVGID_, polyline.select_theme_SVGID_ { fill:none;stroke:red; }\nrect.select_theme_SVGID_, polygon.select_theme_SVGID_, path.select_theme_SVGID_ { fill:red;stroke:none; }\nimage.select_theme_SVGID_ { stroke:red; }","type":"single","only_shiny":true,"selected":[]},"zoom":{"min":1,"max":1,"duration":300},"toolbar":{"position":"topright","pngname":"diagram","tooltips":null,"fixed":false,"hidden":[],"delay_over":200,"delay_out":500},"sizing":{"rescale":true,"width":1}}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section><section id="customized-fonts" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> 4. Customized fonts</h1>
<p>Font styles to be used in your plot is not limited to the fonts you had in your system — this includes the font found in the web, such as Google fonts.</p>
<p>Thanks to <a href="https://github.com/yixuan/sysfonts">sysfonts</a>, you can do:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sysfonts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span><span class="st">"Lobster"</span>, <span class="st">"lobster"</span><span class="op">)</span></span>
<span><span class="fu">sysfonts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html">font_add_google</a></span><span class="op">(</span><span class="st">"Roboto Condensed"</span>, <span class="st">"roboto"</span><span class="op">)</span></span>
<span><span class="fu">showtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then use it as the base font family of the whole plot:</p>
<div class="cell">
<details class="code-fold"><summary>Click to see the code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">hp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#C70039"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"This title is in Lobster font"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"And the rest of the text too if you want"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span>, base_family <span class="op">=</span> <span class="st">"lobster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey40"</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey90"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section id="ggplot2-works-perfectly-without-a-data-frame" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> 5. ggplot2 works perfectly without a data frame</h1>
<p>R’s metaprogramming and its environment semantics is so handy but sometimes quirky: they’re so noble in data analysis and statistical modelling, but sometimes they’re so hard to predict. In many cases when it comes to working with data in R, NSE or the non-standard evaluation is used and one of the core features in <a href="https://tidyverse.tidyverse.org">tidyverse</a>.</p>
<p>Many tutorials and documentations show how to use <a href="https://ggplot2.tidyverse.org">ggplot2</a> with data frames, but do you know that it is still fine to use <a href="https://ggplot2.tidyverse.org">ggplot2</a> without providing a data frame?</p>
<p>The demo:</p>
<div class="cell">
<details class="code-fold"><summary>Click to see the code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">x</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># This is always required! No need to put a data frame</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span></span>
<span>        color <span class="op">=</span> <span class="st">"#002455"</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>        shape <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_smooth</span><span class="op">(</span></span>
<span>        method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>        se <span class="op">=</span> <span class="cn">TRUE</span>,  </span>
<span>        color <span class="op">=</span> <span class="st">"#E7DEAF"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"#E7DEAF"</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"X-axis"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Y-axis"</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Scatter Plot with Linear Regression"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"Pearson's r = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">", "</span>, </span>
<span>            <span class="st">"n = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_x_continuous</span><span class="op">(</span></span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span>, base_family <span class="op">=</span> <span class="st">"lobster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey40"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey90"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>        plot.margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">15</span>, <span class="fl">15</span>, <span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Although I still recommend providing a data frame since that’s how <a href="https://ggplot2.tidyverse.org">ggplot2</a> is designed to be used — especially in many tutorials and documentations.</p>
</section><section id="the-art-of-delay" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> 6. The art of delay</h1>
<p>You may haven’t encounter this but there are 3 particular functions that manipulates aesthetic evaluation:</p>
<ol type="1">
<li>
<p><code>stage()</code> lets you delay the evaluation of aesthetics until the plot is drawn.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Simple demo">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Simple demo
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mpg</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">displ</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span></span>
<span>        <span class="fu">aes</span><span class="op">(</span></span>
<span>            y <span class="op">=</span> <span class="fu">stage</span><span class="op">(</span></span>
<span>                start <span class="op">=</span> <span class="va">hwy</span>,             </span>
<span>                after_scale <span class="op">=</span> <span class="va">y</span> <span class="op">*</span> <span class="fl">2</span>      </span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"#4A90E2"</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Using stage() to modify values after scaling"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Y-axis values are doubled after ggplot2's internal scaling"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Engine Displacement (L)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Highway MPG (scaled × 2)"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"roboto"</span>, base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>after_stat()</code> enables you to modify aesthetics based on computed statistics after they have been calculated.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Simple demo">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Simple demo
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mpg</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>        <span class="fu">aes</span><span class="op">(</span></span>
<span>            y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>,  </span>
<span>            fill <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">count</span><span class="op">)</span>  </span>
<span>        <span class="op">)</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">0.2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Histogram with after_stat()"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Y-axis shows density, fill color shows count"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Highway MPG"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"Count"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span>, base_family <span class="op">=</span> <span class="st">"roboto"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"right"</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>after_scale()</code> allows you to modify aesthetics after they have been scaled but before they are rendered.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Simple demo">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Simple demo
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">wt</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span></span>
<span>        <span class="fu">aes</span><span class="op">(</span></span>
<span>            color <span class="op">=</span> <span class="va">hp</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fu">after_scale</span><span class="op">(</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span>, end <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Using after_scale() for dynamic transparency"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Point transparency adjusted based on scaled color values"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Weight (1000 lbs)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Miles per Gallon"</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"Horsepower"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span>, base_family <span class="op">=</span> <span class="st">"roboto"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</li>
</ol>
<p>These are particularly useful when you want to create plots that depend on dynamic data or when you want to modify aesthetics based on user input in interactive applications.</p>
<p><em>This feature in <a href="https://ggplot2.tidyverse.org">ggplot2</a> is available in version 3.5.0 and later.</em></p>
</section><section id="markdown-within-ggplot2-text-elements" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> 7. Markdown within {ggplot2} text elements</h1>
<p>What I like about <a href="https://wilkelab.org/ggtext/">ggtext</a> is the ability to use markdown syntax within <a href="https://ggplot2.tidyverse.org">ggplot2</a> text elements, such as titles, subtitles, captions, and axis labels. This means you can easily format your text to include <strong>bold</strong>, <em>italic</em>, <code>code</code>, and even <a href="https://ggplot2.tidyverse.org/">links</a> directly within your plots.</p>
<div class="cell">
<details class="code-fold"><summary>Click to see the code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">ggtext</span><span class="op">[</span><span class="va">element_markdown</span><span class="op">]</span>, </span>
<span>    <span class="va">dplyr</span><span class="op">[</span><span class="va">mutate</span><span class="op">]</span>, </span>
<span>    <span class="va">tidyr</span><span class="op">[</span>long <span class="op">=</span> <span class="va">pivot_longer</span><span class="op">]</span>, </span>
<span>    <span class="va">stringr</span><span class="op">[</span>replace_all <span class="op">=</span> <span class="va">str_replace_all</span>, to_title <span class="op">=</span> <span class="va">str_to_title</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">iris_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    setosa <span class="op">=</span> <span class="st">"#D83F87"</span>,   </span>
<span>    versicolor <span class="op">=</span> <span class="st">"#36E2A3"</span>,   </span>
<span>    virginica <span class="op">=</span> <span class="st">"#7B68EE"</span>    </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>        Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">Species</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">long</span><span class="op">(</span></span>
<span>        cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,</span>
<span>        names_to  <span class="op">=</span> <span class="st">"features"</span>,</span>
<span>        values_to <span class="op">=</span> <span class="st">"sizes"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>        features <span class="op">=</span> <span class="fu">to_title</span><span class="op">(</span><span class="fu">replace_all</span><span class="op">(</span><span class="va">features</span>, <span class="st">"\\."</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Species</span>, y <span class="op">=</span> <span class="va">sizes</span>, color <span class="op">=</span> <span class="va">Species</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_violin</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.65</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>                  </span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>        width <span class="op">=</span> <span class="fl">0.25</span>, </span>
<span>        outlier.alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">0.6</span>, </span>
<span>        fill <span class="op">=</span> <span class="st">"white"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span>     </span>
<span>    <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_sina.html">geom_sina</a></span><span class="op">(</span></span>
<span>        alpha <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>        size <span class="op">=</span> <span class="fl">2.2</span>, </span>
<span>        shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"gray20"</span>, </span>
<span>        stroke <span class="op">=</span> <span class="fl">0.4</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">iris_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">iris_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">features</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        title    <span class="op">=</span> <span class="st">"&lt;b&gt;Iris Dataset – Distribution of Measurements by Species&lt;/b&gt;"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"Species: &lt;span style='color:#D83F87;'&gt;**setosa**&lt;/span&gt; | "</span>,</span>
<span>            <span class="st">"&lt;span style='color:#36E2A3;'&gt;**versicolor**&lt;/span&gt; | "</span>,</span>
<span>            <span class="st">"&lt;span style='color:#7B68EE;'&gt;**virginica**&lt;/span&gt;"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        y <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_classic</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"lobster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span></span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">13</span>, margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>b <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span>, face <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"gray95"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, <span class="co"># element_text(size = 12)</span></span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray88"</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,  </span>
<span>        <span class="co"># panel.grid.minor.y = element_line(color = "gray94", linewidth = 0.25), </span></span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span></span>
<span>    <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The <code>element_markdown()</code> function replaces standard theme text elements and parses markdown/HTML. You can use:</p>
<ul>
<li>Markdown: <code>**bold**</code>, <code>*italic*</code>, <code>`code`</code>
</li>
<li>HTML tags: <code>&lt;span&gt;</code>, <code>&lt;br&gt;</code>, <code>&lt;sup&gt;</code>, <code>&lt;sub&gt;</code>, and more</li>
<li>Inline CSS: <code>&lt;span style='color:red;'&gt;colored text&lt;/span&gt;</code>
</li>
</ul></section><section id="resources" class="level1" data-number="9"><h1 data-number="9">
<span class="header-section-number">9</span> Resources</h1>
<ul>
<li><a href="https://ggplot2.tidyverse.org/">ggplot2 Official Documentation</a></li>
<li><a href="https://ggplot2-book.org/">ggplot2 Book by Hadley Wickham</a></li>
<li><a href="https://github.com/tidyverse/ggplot2">ggplot2 GitHub Repository</a></li>
<li><a href="https://r-graphics.org/">R Graphics Cookbook by Winston Chang</a></li>
<li><a href="https://github.com/yixuan/showtext">showtext Package Documentation</a></li>
<li><a href="https://coolbutuseless.github.io/package/ggpattern/">ggpattern Package</a></li>
<li><a href="https://davidgohel.github.io/ggiraph/">ggiraph Package</a></li>
<li><a href="https://github.com/RConsortium/S7">S7 OOP System</a></li>
<li><a href="https://exts.ggplot2.tidyverse.org/">ggplot2 Extensions Gallery</a></li>
<li><a href="https://www.cedricscherer.com/">Cedric Scherer’s ggplot2 Tutorials</a></li>
</ul>


</section></main><!-- /main --><style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

/* Light theme variables */
:root {
  --primary-color: #3b82f6;
  --primary-dark: #2563eb;
  --secondary-color: #64748b;
  --accent-color: #06b6d4;
  --background: #ffffff;
  --surface: #f8fafc;
  --surface-hover: #f1f5f9;
  --surface-light: #e2e8f0;
  --border: #e2e8f0;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --radius: 8px;
  --radius-lg: 12px;
}

/* Dark theme variables */
[data-theme="dark"] {
  --primary-color: #60a5fa;
  --primary-dark: #3b82f6;
  --secondary-color: #94a3b8;
  --accent-color: #22d3ee;
  --background: #0f172a;
  --surface: #1e293b;
  --surface-hover: #334155;
  --surface-light: #475569;
  --border: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.5);
}

/* =========================
   Navbar Theme Fix
   ========================= */

/* Target all navbar elements to use theme colors */
.navbar,
.navbar-default,
.navbar-expand-lg,
nav.navbar,
header.navbar,
#quarto-header,
.quarto-navbar,
nav[role="navigation"] {
  background: var(--background) !important;
  border-bottom: 1px solid var(--border) !important;
  box-shadow: var(--shadow-sm) !important;
}

/* =========================
   Title Block Banner Theme Fix
   ========================= */

/* Target title block banner area */
#title-block-header,
.quarto-title-block,
header#title-block-header,
.quarto-title-banner {
  background: var(--background) !important;
  color: var(--text-primary) !important;
}

/* Title block container */
.quarto-title-block .quarto-title,
#title-block-header .quarto-title {
  background: var(--background) !important;
}

/* =========================
   Listing Controls Theme Fix (Sorter/Filter)
   ========================= */

/* Order By / Sort dropdown and Filter input */
.listing-option-group,
.listing-actions,
.listing-controls,
div[class*="listing"] {
  background: var(--background) !important;
}

/* Dropdowns and inputs in listing controls */
.listing-option-group select,
.listing-option-group input,
#listing-order-by,
select,
input[type="text"],
input[type="search"] {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border) !important;
}

.listing-option-group select:hover,
.listing-option-group input:hover,
select:hover,
input[type="text"]:hover,
input[type="search"]:hover {
  background: var(--surface-hover) !important;
  border-color: var(--primary-color) !important;
}

/* Labels in listing controls */
.listing-option-group label,
.listing-controls label {
  color: var(--text-primary) !important;
}

/* =========================
   Footer Theme Fix
   ========================= */

/* Footer area */
footer,
.footer,
.nav-footer,
.quarto-footer,
body > footer,
#quarto-footer {
  background: var(--surface) !important;
  color: var(--text-secondary) !important;
  border-top: 1px solid var(--border) !important;
}

/* Footer links */
footer a,
.footer a,
.nav-footer a,
.quarto-footer a {
  color: var(--text-secondary) !important;
}

footer a:hover,
.footer a:hover,
.nav-footer a:hover,
.quarto-footer a:hover {
  color: var(--primary-color) !important;
}

/* Footer text */
footer p,
footer div,
.footer p,
.footer div,
.nav-footer p,
.nav-footer div {
  color: var(--text-secondary) !important;
}

/* Navbar brand/logo */
.navbar-brand,
.navbar-title,
a.navbar-brand {
  color: var(--text-primary) !important;
}

/* Navbar links */
.navbar-nav .nav-link,
.navbar .nav-link,
.navbar a,
.nav-link {
  color: var(--text-secondary) !important;
}

.navbar-nav .nav-link:hover,
.navbar .nav-link:hover,
.navbar a:hover,
.nav-link:hover {
  color: var(--primary-color) !important;
}

/* Active navbar link */
.navbar-nav .nav-link.active,
.navbar .nav-link.active,
.nav-link.active {
  color: var(--primary-color) !important;
}

/* Navbar toggler*/
.navbar-toggler {
  border-color: var(--border) !important;
  padding: 0.25rem 0.5rem;
}

.navbar-toggler:focus {
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

/* Create custom hamburger icon that respects theme */
.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(71, 85, 105, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
  display: inline-block;
  width: 1.5em;
  height: 1.5em;
  vertical-align: middle;
}

/* Dark theme hamburger icon */
[data-theme="dark"] .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(203, 213, 225, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
}

/* Search button and icons in navbar */
.navbar .quarto-navbar-tools,
.navbar-nav .nav-item i,
.navbar i {
  color: var(--text-secondary) !important;
}

.navbar .quarto-navbar-tools:hover,
.navbar-nav .nav-item i:hover,
.navbar i:hover {
  color: var(--primary-color) !important;
}

/* Theme toggle button - repositioned to avoid navbar overlap */
.theme-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  background: var(--primary-color);
  color: white;
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.25rem;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background: var(--primary-dark);
  transform: scale(1.1);
  box-shadow: 0 15px 25px -5px rgb(0 0 0 / 0.3);
}

.theme-toggle:active {
  transform: scale(0.95);
}

/* Base styles with smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Remove automatic numbering for headings */
body {
  counter-reset: none;
}

h1::before,
h2::before,
h3::before,
h4::before,
h5::before,
h6::before {
  content: none !important;
}

/* Override any automatic numbering */
.section .header-section-number {
  display: none !important;
}

.header-section-number {
  display: none !important;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  line-height: 1.7;
  color: var(--text-primary);
  background: var(--background);
  margin: 0;
  padding: 0;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Container styling */
.container-fluid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  padding-top: 4rem; 
}

/* Header styling with enhanced animations */
.title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  line-height: 1.2;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: slideInFromTop 0.8s ease-out;
}

.subtitle {
  font-size: 1.25rem;
  color: var(--text-secondary);
  margin-bottom: 2rem;
  font-weight: 400;
  animation: slideInFromTop 0.8s ease-out 0.2s both;
}

.author, .date {
  color: var(--text-muted);
  font-size: 1.325rem;
  margin-bottom: 0.5rem;
  animation: slideInFromTop 0.8s ease-out 0.4s both;
}

/* Animations */
@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* =========================
   Table of Contents
   ========================= */

#TOC {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-sm);
  animation: fadeIn 0.8s ease-out 0.6s both;
}

/* Force all TOC elements to use theme colors */
#TOC,
#TOC ul,
#TOC li,
#TOC div {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
}

/* Hide "on this page" text in TOC - Multiple selectors for compatibility */
body.quarto-post #TOC .toc-title,
#TOC .toc-title,
.toc-title,
#quarto-margin-sidebar .toc-title,
.sidebar nav[role="doc-toc"] > h2,
.sidebar nav[role="doc-toc"] > .h2,
#quarto-margin-sidebar h2,
aside[role="complementary"] h2,
nav[role="doc-toc"] h2 {
  display: none !important;
}

#TOC ul {
  margin: 0;
  padding-left: 1.25rem;
  list-style: none;
  background: var(--surface) !important;
}

#TOC > ul {
  padding-left: 0;
  background: var(--surface) !important;
}

#TOC li {
  margin: 0.5rem 0;
  position: relative;
  transform: translateX(0);
  transition: transform 0.2s ease;
  background: var(--surface) !important;
}

#TOC li:hover {
  transform: translateX(5px);
  background: var(--surface) !important;
}

#TOC li::before {
  content: "→";
  color: var(--primary-color);
  font-weight: bold;
  position: absolute;
  left: -1rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

#TOC li:hover::before {
  opacity: 1;
}

#TOC a {
  color: var(--text-primary) !important;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.2s ease;
  display: block;
  padding: 0.25rem 0;
  border-radius: var(--radius);
  padding-left: 0.5rem;
  background: transparent !important;
}

#TOC a:hover {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Target specific R Markdown TOC structure */
.tocify-wrapper,
.tocify-extend-page {
  background: var(--surface) !important;
}

/* Override any white backgrounds in TOC */
#TOC * {
  background-color: var(--surface) !important;
}

#TOC a * {
  background-color: transparent !important;
}

/* Floating TOC with enhanced styling */
.tocify {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  padding: 1rem;
  backdrop-filter: blur(10px);
}

.tocify-header {
  font-weight: 600;
  color: var(--text-primary) !important;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 0.5rem;
}

.tocify-item {
  padding: 0.25rem 0;
}

.tocify-item a {
  color: var(--text-secondary) !important;
  text-decoration: none;
  transition: all 0.2s ease;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius);
  display: block;
}

.tocify-item a:hover,
.tocify-item.active a {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Headers styling */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  margin-top: 2.5rem;
  margin-bottom: 1rem;
  line-height: 1.3;
  color: var(--text-primary);
}

h1 {
  font-size: 2.25rem;
  border-bottom: 3px solid var(--primary-color);
  padding-bottom: 0.75rem;
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
}

h1::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: -100%;
  right: 100%;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
  animation: shimmer 2s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% {
    left: -100%;
    right: 100%;
  }
  50% {
    left: 0%;
    right: 0%;
  }
}

h2 {
  font-size: 1.875rem;
  color: var(--primary-dark);
  position: relative;
  padding-left: 1rem;
}

h2::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0.25rem;
  bottom: 0.25rem;
  width: 4px;
  background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
  border-radius: 2px;
  transform: scaleY(0);
  transform-origin: top;
  transition: transform 0.3s ease;
}

h2:hover::before {
  transform: scaleY(1);
}

h3 {
  font-size: 1.5rem;
  color: var(--text-primary);
}

h4 {
  font-size: 1.25rem;
  color: var(--secondary-color);
}

/* Interactive code folding button */
.code-folding-btn {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  border: none;
  padding: 0.75rem 1.25rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 600;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
}

.code-folding-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.code-folding-btn:active {
  transform: translateY(0);
}

.code-folding-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.code-folding-btn:hover::after {
  left: 100%;
}

/* =========================
   Callout title
   ========================= */

.callout-title-container {
  color: #19183B !important;
}

/* =========================
   Global hyperlink styling
   ========================= */

/* Global styling - Light mode */
a:not(.quarto-category):not(.listing-category),
a:visited:not(.quarto-category):not(.listing-category) {
  color: #3A6F43 !important;
  text-decoration: none;
}

a:hover:not(.quarto-category):not(.listing-category) {
  color: #333333 !important;
}

/* Dark mode hyperlinks */
[data-theme="dark"] a:not(.quarto-category):not(.listing-category),
[data-theme="dark"] a:visited:not(.quarto-category):not(.listing-category) {
  color: #8BAE66 !important;
}

[data-theme="dark"] a:hover:not(.quarto-category):not(.listing-category) {
  color: #a8cc88 !important;
}

/* =========================
   Category Links Fix
   ========================= */

/* Ensure category links remain functional */
.quarto-category,
a.quarto-category,
.quarto-categories .quarto-category,
.listing-category,
a.listing-category {
  pointer-events: auto !important;
  cursor: pointer !important;
  color: inherit !important;
  text-decoration: none !important;
}

.quarto-category:hover,
.listing-category:hover {
  opacity: 0.8 !important;
  text-decoration: none !important;
}

/* =========================
   Strong Global bold text
   ========================= */

strong, b {
  font-weight: 700;
}

/* Enhanced blockquotes */
blockquote {
  border-left: 4px solid var(--accent-color);
  margin: 1.5rem 0;
  padding: 1rem 1.5rem;
  background: var(--surface);
  border-radius: 0 var(--radius) var(--radius) 0;
  color: var(--text-secondary);
  font-style: italic;
  position: relative;
  box-shadow: var(--shadow-sm);
}

blockquote::before {
  content: """;
  font-size: 3rem;
  color: var(--accent-color);
  position: absolute;
  top: -10px;
  left: 10px;
  opacity: 0.3;
}

/* Smooth scrolling and enhanced focus */
html {
  scroll-behavior: smooth;
}

/* Selection styling */
::selection {
  background: var(--primary-color);
  color: white;
}

::-moz-selection {
  background: var(--primary-color);
  color: white;
}

/* Enhanced focus styles */
button:focus,
a:focus,
input:focus,
textarea:focus {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
  border-radius: var(--radius);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: var(--surface);
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 6px;
  border: 2px solid var(--surface);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--secondary-color);
}

/* Responsive design */
@media (max-width: 768px) {
  .theme-toggle {
    bottom: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
    font-size: 1.1rem;
  }
  
  .container-fluid {
    padding: 1rem;
    padding-top: 3rem;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .subtitle {
    font-size: 1.725rem;
  }
  
  h1 {
    font-size: 1.875rem;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  pre {
    padding: 1rem;
  }
  
  pre code {
    font-size: 0.9rem;
  }
}

/* Print styles */
@media print {
  .theme-toggle {
    display: none;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.5;
    color: black;
    background: white;
  }
  
  .title {
    color: black;
    -webkit-text-fill-color: black;
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: black;
    page-break-after: avoid;
  }
  
  pre, blockquote {
    page-break-inside: avoid;
  }
  
  .tocify {
    display: none;
  }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.createElement('button');
  themeToggle.className = 'theme-toggle';
  themeToggle.innerHTML = '🌙';
  themeToggle.setAttribute('aria-label', 'Toggle dark mode');
  themeToggle.setAttribute('title', 'Toggle dark/light mode');
  
  document.body.appendChild(themeToggle);
  
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  themeToggle.innerHTML = savedTheme === 'dark' ? '🌙' : '☀️';
  
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    themeToggle.innerHTML = newTheme === 'dark' ? '🌙' : '☀️';
    
    themeToggle.style.transform = 'rotate(360deg)';
    setTimeout(() => {
      themeToggle.style.transform = 'rotate(0deg)';
    }, 300);
  });
  
  setTimeout(function() {
    const tocTitles = document.querySelectorAll('.toc-title, #quarto-margin-sidebar h2, nav[role="doc-toc"] h2');
    tocTitles.forEach(function(title) {
      title.style.display = 'none';
    });
  }, 100);
  
  const tocLinks = document.querySelectorAll('#TOC a, .tocify a');
  tocLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });
  
  const images = document.querySelectorAll('img');
  images.forEach(function(img) {
    if (img.complete) {
      img.style.opacity = '1';
    } else {
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.5s ease';
      
      img.addEventListener('load', function() {
        this.style.opacity = '1';
      });
    }
  });
});
</script><style>
    /* Modal Styles */
    .code-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    .code-modal-content {
        position: relative;
        background-color: #fff;
        margin: 5% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 1200px;
        max-height: 80vh;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .code-modal-header {
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
    }

    .code-modal-title {
        font-size: 1.2em;
        font-weight: 600;
        margin: 0;
    }

    .code-modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }

    .code-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .code-modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #f8f9fa;
    }

    .code-modal-section {
        margin-bottom: 20px;
    }

    .code-modal-section:last-child {
        margin-bottom: 0;
    }

    .code-modal-section h3 {
        margin: 0 0 10px 0;
        font-size: 1.1em;
        color: #333;
        padding-bottom: 5px;
        border-bottom: 2px solid #1e3a8a;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .code-modal-code {
        background-color: #0f172a;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        overflow-x: auto;
        white-space: pre;
        margin: 0;
    }

    .code-modal-output {
        background-color: #fff;
        border: 1px solid #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        white-space: pre-wrap;
        margin: 0;
        color: #2d3748;
    }

    /* Button to open modal */
    .code-open-btn {
        background: #0f172a;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85em;
        font-weight: 500;
        margin: 5px 0;
        transition: all 0.3s ease;
    }

    .code-open-btn:hover {
        background: #1e293b;
        transform: translateY(-1px);
    }

    /* Copy button styles */
    .copy-btn {
        background: #1e3a8a;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.75em;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s ease;
    }

    .copy-btn:hover {
        background: #1e40af;
    }

    .copy-btn.copied {
        background: #059669;
    }

    .copy-icon {
        width: 14px;
        height: 14px;
        fill: currentColor;
    }

    /* Hide original code blocks that have code-open */
    .cell[data-code-open="true"] .sourceCode {
        display: none;
    }

    .cell[data-code-open="true"] .cell-output {
        display: none;
    }

    /* Animation */
    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .code-modal.show .code-modal-content {
        animation: modalFadeIn 0.3s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .code-modal-content {
            width: 95%;
            margin: 2% auto;
            max-height: 90vh;
        }

        .code-modal-header {
            padding: 10px 15px;
        }

        .code-modal-body {
            padding: 15px;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to create modal
        function createModal() {
            const modal = document.createElement('div');
            modal.className = 'code-modal';
            document.body.appendChild(modal);
            return modal;
        }

        // Create the modal
        const modal = createModal();
        const modalContent = modal.querySelector('.code-modal-content');
        const closeBtn = modal.querySelector('.code-modal-close');
        const codeElement = modal.querySelector('.code-modal-code');
        const outputElement = modal.querySelector('.code-modal-output');

        // Function to open modal
        function openModal(codeText, outputText, title = 'Code & Output') {
            modal.querySelector('.code-modal-title').textContent = title;
            codeElement.textContent = codeText;
            outputElement.textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }

        // Function to close modal
        function closeModal() {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        // Event listeners for modal
        closeBtn.addEventListener('click', closeModal);

        // Copy functionality
        const copyCodeBtn = modal.querySelector('#copy-code-btn');
        const copyOutputBtn = modal.querySelector('#copy-output-btn');

        copyCodeBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(codeElement.textContent);
                copyCodeBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyCodeBtn.classList.add('copied');
                setTimeout(() => {
                    copyCodeBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyCodeBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy code:', err);
            }
        });

        copyOutputBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(outputElement.textContent);
                copyOutputBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyOutputBtn.classList.add('copied');
                setTimeout(() => {
                    copyOutputBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyOutputBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy output:', err);
            }
        });

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        // Function to extract title from Quarto cell metadata
        function extractTitleFromCell(cell) {
            // Look for code-modal-title in various places
            let title = null;

            // 1. Check for data attribute on the cell
            if (cell.hasAttribute('data-code-modal-title')) {
                title = cell.getAttribute('data-code-modal-title');
            }

            // 2. Check for code-modal-title in cell options (Quarto metadata)
            const cellOptions = cell.querySelector('.cell-meta, .cell-code-meta');
            if (cellOptions && !title) {
                const optionsText = cellOptions.textContent;
                const titleMatch = optionsText.match(/code-modal-title:\s*["']([^"']+)["']/);
                if (titleMatch) {
                    title = titleMatch[1];
                }
            }

            // 3. Look for title in HTML comments (Quarto sometimes puts metadata there)
            const htmlContent = cell.innerHTML;
            const commentMatch = htmlContent.match(/<!--.*?code-modal-title:\s*["']([^"']+)["'].*?-->/s);
            if (commentMatch && !title) {
                title = commentMatch[1];
            }

            // 4. Look for title in the cell's script tags or data attributes
            const scripts = cell.querySelectorAll('script[type="application/json"]');
            scripts.forEach(script => {
                if (!title) {
                    try {
                        const data = JSON.parse(script.textContent);
                        if (data['code-modal-title']) {
                            title = data['code-modal-title'];
                        }
                    } catch (e) {
                        // Ignore JSON parse errors
                    }
                }
            });

            // 5. Look in the raw text content for the pattern
            if (!title) {
                const rawText = cell.textContent;
                const rawMatch = rawText.match(/code-modal-title:\s*["']?([^"'\n]+)["']?/);
                if (rawMatch) {
                    title = rawMatch[1].trim().replace(/["']/g, '');
                }
            }

            // 6. Alternative pattern matching for YAML-like syntax
            if (!title) {
                const yamlMatch = htmlContent.match(/code-modal-title:\s*(.+)/);
                if (yamlMatch) {
                    title = yamlMatch[1].trim().replace(/["']/g, '');
                }
            }

            return title;
        }

        // Function to process code blocks with code-open attribute
        function processCodeOpenBlocks() {
            // Look for cells with code-open attribute in Quarto
            const cells = document.querySelectorAll('.cell');

            cells.forEach((cell, index) => {
                // Skip if already processed
                if (cell.hasAttribute('data-processed')) return;

                // Check if this cell should have code-open functionality
                const hasCodeOpen = cell.querySelector('[data-code-open="true"]') ||
                    cell.hasAttribute('data-code-open') ||
                    cell.innerHTML.includes('code-open: true') ||
                    cell.textContent.includes('code-open: true');

                if (hasCodeOpen) {
                    // Mark the cell as processed
                    cell.setAttribute('data-code-open', 'true');
                    cell.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(cell);

                    // Find source code
                    const sourceCode = cell.querySelector('.sourceCode code, pre code, .r code');
                    const codeText = sourceCode ? sourceCode.textContent : '';

                    // Find output
                    const outputElements = cell.querySelectorAll('.cell-output pre, .cell-output .output');
                    let outputText = '';
                    outputElements.forEach(output => {
                        outputText += output.textContent + '\n';
                    });

                    // Create open button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        // Use custom title if available, otherwise default
                        const title = customTitle || `Code Block ${index + 1}`;
                        openModal(codeText, outputText.trim(), title);
                    });

                    // Insert button at the beginning of the cell
                    cell.insertBefore(openBtn, cell.firstChild);
                }
            });
        }

        // Alternative approach for direct code blocks
        function processDirectCodeBlocks() {
            const codeBlocks = document.querySelectorAll('pre code');

            codeBlocks.forEach(code => {
                const preElement = code.parentElement;
                const container = preElement.parentElement;

                // Skip if already processed
                if (container.hasAttribute('data-processed')) return;

                // Check for code-open in various ways
                if (container.hasAttribute('data-code-open') ||
                    container.classList.contains('code-open') ||
                    preElement.hasAttribute('data-code-open') ||
                    container.innerHTML.includes('code-open: true')) {

                    // Mark as processed
                    container.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(container);

                    const codeText = code.textContent;

                    // Look for adjacent output
                    let outputText = '';
                    let nextElement = container.nextElementSibling;
                    if (nextElement && (nextElement.tagName === 'PRE' || nextElement.classList.contains('output'))) {
                        outputText = nextElement.textContent;
                    }

                    // Create and insert button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        const title = customTitle || 'Code Block';
                        openModal(codeText, outputText, title);
                    });

                    // Hide original and add button
                    container.style.display = 'none';
                    if (nextElement && outputText) {
                        nextElement.style.display = 'none';
                    }

                    container.parentElement.insertBefore(openBtn, container);
                }
            });
        }

        // Run processing functions
        processCodeOpenBlocks();
        processDirectCodeBlocks();

        // Also run after a short delay to catch dynamically loaded content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 1000);

        // Run again after a longer delay for slow-loading content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 3000);
    });

    // Manual function to add code-open functionality
    function addCodeOpen(codeElement, outputElement, title) {
        const openBtn = document.createElement('button');
        openBtn.className = 'code-open-btn';
        openBtn.textContent = 'View Code & Output';

        openBtn.addEventListener('click', function() {
            const codeText = codeElement.textContent;
            const outputText = outputElement ? outputElement.textContent : '';

            // Trigger the modal (assuming the modal is already created)
            const modal = document.querySelector('.code-modal');
            if (modal) {
                const event = new CustomEvent('openCodeModal', {
                    detail: { codeText, outputText, title }
                });
                document.dispatchEvent(event);
            }
        });

        return openBtn;
    }

    // Listen for custom events
    document.addEventListener('openCodeModal', function(e) {
        const { codeText, outputText, title } = e.detail;
        const modal = document.querySelector('.code-modal');
        if (modal) {
            modal.querySelector('.code-modal-title').textContent = title || 'Code & Output';
            modal.querySelector('.code-modal-code').textContent = codeText;
            modal.querySelector('.code-modal-output').textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }
    });
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/joshuamarie\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><script src="https://utteranc.es/client.js" repo="joshuamarie/joshuamarie" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Design inspired by <a href="https://github.com/statichunt/geeky-hugo">Geeky Hugo</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/joshuamarie/joshuamarie/edit/main/posts/09-ggplot2/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>