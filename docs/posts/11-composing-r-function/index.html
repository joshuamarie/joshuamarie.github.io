<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Joshua Marie">
<meta name="dcterms.date" content="2025-12-15">
<meta name="description" content="Introducing the 3 ways to compose functions in R.">
<title>Three levels to compose R functions – Joshua Marie</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/jm-favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0a95de2c3be981c2e03029825b16c585.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c2a4070949356990582fa11d5da3dd57.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-1.0.0/all.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9842567530621468" crossorigin="anonymous"></script><link rel="stylesheet" href="../../styles/base.css">
<link rel="stylesheet" href="../../styles/layout.css">
<link rel="stylesheet" href="../../styles/hero.css">
<link rel="stylesheet" href="../../styles/cards.css">
<link rel="stylesheet" href="../../styles/about.css">
<link rel="stylesheet" href="../../styles/dark-mode.css">
<link rel="stylesheet" href="../Theme/code.css">
<link rel="stylesheet" href="../Theme/table.css">
<meta name="twitter:title" content="Three levels to compose R functions – Joshua Marie">
<meta name="twitter:description" content="Introducing the 3 ways to compose functions in R.">
<meta name="twitter:image" content="https://joshuamarie.com/posts/11-composing-r-function/image.png">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joshua Marie</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../contacts.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">My resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joshuamarie"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joshuamarie/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joshua.marie.k@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS Feed">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Three levels to compose R functions</h1>
            <p class="subtitle lead">Intro to my functional programming series</p>
                  <div>
        <div class="description">
          Introducing the 3 ways to compose functions in R.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">data-science</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">purrr</div>
                <div class="quarto-category">functional-programming</div>
                <div class="quarto-category">fp</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joshua Marie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 15, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#manual-compose" id="toc-manual-compose" class="nav-link active" data-scroll-target="#manual-compose"><span class="header-section-number">1</span> Level 1: Manual Composition</a>
  <ul class="collapse">
<li><a href="#creating-wrapper-functions" id="toc-creating-wrapper-functions" class="nav-link" data-scroll-target="#creating-wrapper-functions"><span class="header-section-number">1.1</span> Creating Wrapper Functions</a></li>
  <li><a href="#application-in-functionals" id="toc-application-in-functionals" class="nav-link" data-scroll-target="#application-in-functionals"><span class="header-section-number">1.2</span> Application in <em>functionals</em></a></li>
  </ul>
</li>
  <li>
<a href="#higher-order" id="toc-higher-order" class="nav-link" data-scroll-target="#higher-order"><span class="header-section-number">2</span> Level 2: Using Higher-order Functions</a>
  <ul class="collapse">
<li><a href="#function-composition-with-purrrcompose" id="toc-function-composition-with-purrrcompose" class="nav-link" data-scroll-target="#function-composition-with-purrrcompose"><span class="header-section-number">2.1</span> Function Composition with purrr::compose()</a></li>
  <li><a href="#partial-application-with-purrrpartial" id="toc-partial-application-with-purrrpartial" class="nav-link" data-scroll-target="#partial-application-with-purrrpartial"><span class="header-section-number">2.2</span> Partial Application with purrr::partial()</a></li>
  <li>
<a href="#function-operators-in-general" id="toc-function-operators-in-general" class="nav-link" data-scroll-target="#function-operators-in-general"><span class="header-section-number">2.3</span> Function Operators in general</a>
  <ul class="collapse">
<li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">2.3.1</span> Example 1:</a></li>
  <li><a href="#example-2-creating-a-memoization-operator" id="toc-example-2-creating-a-memoization-operator" class="nav-link" data-scroll-target="#example-2-creating-a-memoization-operator"><span class="header-section-number">2.3.2</span> Example 2: Creating a Memoization Operator</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#program" id="toc-program" class="nav-link" data-scroll-target="#program"><span class="header-section-number">3</span> Level 3: Programmatic Approach</a>
  <ul class="collapse">
<li><a href="#start-with-the-basic-first" id="toc-start-with-the-basic-first" class="nav-link" data-scroll-target="#start-with-the-basic-first"><span class="header-section-number">3.1</span> Start with the basic first</a></li>
  </ul>
</li>
  <li><a href="#when-to-use-each-approach-here-are-some-of-my-guides" id="toc-when-to-use-each-approach-here-are-some-of-my-guides" class="nav-link" data-scroll-target="#when-to-use-each-approach-here-are-some-of-my-guides"><span class="header-section-number">4</span> When to Use Each Approach (here are some of my guides)</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">5</span> Resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/edit/main/posts/11-composing-r-function/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="page-columns page-rows-contents page-layout-article"><div class="social-share">
<a href="https://twitter.com/share?url=https://joshuamarie.com/posts/11-composing-r-function&amp;text=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://joshuamarie.com/posts/11-composing-r-function&amp;title=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie&amp;body=Check%20out%20this%20link:https://joshuamarie.com/posts/11-composing-r-function" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://joshuamarie.com/posts/11-composing-r-function" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://joshuamarie.com/posts/11-composing-r-function&amp;title=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://joshuamarie.com/posts/11-composing-r-function&amp;title=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://joshuamarie.com/posts/11-composing-r-function&amp;name=Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a><a href="javascript:void(0);" onclick="var mastodon_instance=prompt('Mastodon Instance / Server Name?'); if(typeof mastodon_instance==='string' &amp;&amp; mastodon_instance.length){this.href='https://'+mastodon_instance+'/share?text=Three levels to compose R functions — Joshua Marie https://joshuamarie.com/posts/11-composing-r-function'}else{return false;}" target="_blank" class="mastodon"><i class="fa-brands fa-mastodon fa-fw fa-lg"></i></a><a href="https://bsky.app/intent/compose?text=https://joshuamarie.com/posts/11-composing-r-function%20Three%20levels%20to%20compose%20R%20functions%20%E2%80%94%20Joshua%20Marie" target="_blank" class="bsky"><i class="fa-brands fa-bluesky"></i></a>
</div></div>


<p>Maybe few people who use R have forgotten already that R is functional by heart. R has Python dogma OO system, thanks to <em>Reference Class</em> (RC) and R6. R functions can be treated as Lisp’s macros, where it can let you meddle the function and <em>abstract syntax tree</em> (AST) of the function call.</p>
<p>R has few ways to compose a function, divided by three (3) levels:</p>
<ol type="1">
<li><a href="#manual-compose">Manual Typing</a></li>
<li><a href="#higher-order">Higher-order Functions</a></li>
<li><a href="#program">Programmatic</a></li>
</ol>
<section id="manual-compose" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Level 1: Manual Composition</h1>
<p>At the most basic level, we compose functions by manually writing them out. This is the approach most R users start with, and it’s perfectly valid for many use cases.</p>
<section id="creating-wrapper-functions" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="creating-wrapper-functions">
<span class="header-section-number">1.1</span> Creating Wrapper Functions</h2>
<p>Sometimes we want to reuse a composition pattern. We can manually create a wrapper function with <code>function</code> keyword:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">normalize</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu">normalize</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.2649111 -0.6324555  0.0000000  0.6324555  1.2649111</code></pre>
</div>
</div>
<p>While this level of composition is explicit, straightforward, and easy to understand, it requires writing out each function definition manually, which can become repetitive when you have many similar transformations.</p>
</section><section id="application-in-functionals" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="application-in-functionals">
<span class="header-section-number">1.2</span> Application in <em>functionals</em>
</h2>
<p>Many base R and tidyverse functions are <em>functionals</em>: they take a function as input and apply it across data (e.g., <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>, <code><a href="https://rdrr.io/r/stats/integrate.html">integrate()</a></code>).</p>
<p>To compose functions for functionals, instead of manually writing function from the outside of the call:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sqrt2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">sqrt2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000000 1.414214 1.732051 2.000000 2.236068</code></pre>
</div>
</div>
<p>You can compose on the fly with anonymous functions (you can just refer it as an “unassigned function” if you want):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000000 1.414214 1.732051 2.000000 2.236068</code></pre>
</div>
</div>
<p>Or use the modern shorthand <code>\()</code> (after 4.1):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000000 1.414214 1.732051 2.000000 2.236068</code></pre>
</div>
</div>
<p>Even better — show that <code>\()</code> is just syntactic sugar for <code>function()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>function(x) x^2</code></pre>
</div>
</div>
</section></section><section id="higher-order" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Level 2: Using Higher-order Functions</h1>
<p>How about we comprises the existing functions and give birth to another function? We can easily make that with <code><a href="https://purrr.tidyverse.org/reference/compose.html">purrr::compose()</a></code>. How about we create a function out of the function? That’s <em>function operators</em> in action.</p>
<p>Higher-order functions can return new functions by combining or modifying existing ones, reducing manual code writing.</p>
<section id="function-composition-with-purrrcompose" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="function-composition-with-purrrcompose">
<span class="header-section-number">2.1</span> Function Composition with purrr::compose()</h2>
<p>The nice thing about this is that it takes multiple functions and creates a single new function that applies them in sequence (the default direction is <em>backwards</em>).</p>
<p>So, instead of writing this manually:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">transform</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9785184</code></pre>
</div>
</div>
<p>We can compose it through <code><a href="https://purrr.tidyverse.org/reference/compose.html">purrr::compose()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="va">sqrt</span>, <span class="va">mean</span>, <span class="va">log</span><span class="op">)</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9785184</code></pre>
</div>
</div>
<p>Furthermore, this is also (almost) as readable as using pipe:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9785184</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>I have a <a href="https://joshuamarie.com/posts/05-pipes/#the-early-days-pre-pipe-workflows-2010">different blog</a> mentioning on how bad can the nested function call go.</p>
</blockquote>
<p>This function can be read from left to right (by default, it is read vice-versa):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="va">sqrt</span>, <span class="va">mean</span>, <span class="va">log</span>, .dir <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5166883</code></pre>
</div>
</div>
<p>Which is an equivalent of:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5166883</code></pre>
</div>
</div>
<p>This function can take the inverse: can be read from left to right (by default, it is read vice-versa):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">transform_forward</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/compose.html">compose</a></span><span class="op">(</span><span class="va">sqrt</span>, <span class="va">mean</span>, <span class="va">log</span>, .dir <span class="op">=</span> <span class="st">"forward"</span><span class="op">)</span></span>
<span><span class="fu">transform_forward</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5166883</code></pre>
</div>
</div>
<p>Which is an equivalent of:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5166883</code></pre>
</div>
</div>
</section><section id="partial-application-with-purrrpartial" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="partial-application-with-purrrpartial">
<span class="header-section-number">2.2</span> Partial Application with purrr::partial()</h2>
<p>Another function from <a href="https://purrr.tidyverse.org/">purrr</a> is the <code><a href="https://purrr.tidyverse.org/reference/partial.html">purrr::partial()</a></code>, where the application is where you “pre-fill” some arguments of a function, creating a new function with fewer parameters. This is incredibly useful for creating specialized versions of general functions.</p>
<p>Consider this function, where a number argument <code>x</code> is divided by 100:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">divide_by_100</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">/</span> <span class="fl">100</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">divide_by_100</span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<p>We can write as:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">divide_by_100</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/partial.html">partial</a></span><span class="op">(</span><span class="va">`/`</span>, e2 <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu">divide_by_100</span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<p>If you ask “what’s the point of partial application”, this can be particularly useful in conjunction with functionals and other function operators, and also supports <a href="https://rlang.r-lib.org">rlang</a> and NSE APIs — which means you can write it without “typing too much”.</p>
</section><section id="function-operators-in-general" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="function-operators-in-general">
<span class="header-section-number">2.3</span> Function Operators in general</h2>
<p>In case you don’t know, decorators in Python are just “function operators” in general, except it is pretty much tied into Python and coated with syntactic sugars.</p>
<p>Function operators take functions as input and return modified functions as output. They’re like functions that operate on the “function space” rather than the data space.</p>
<section id="example-1" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="example-1">
<span class="header-section-number">2.3.1</span> Example 1:</h3>
<p>Function operators can add behavior without changing the core logic:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">with_logging</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Calling function with args:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>        <span class="va">res</span> <span class="op">=</span> <span class="fu">f</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Result:"</span>, <span class="va">res</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>        <span class="va">res</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">logged_sqrt</span> <span class="op">=</span> <span class="fu">with_logging</span><span class="op">(</span><span class="va">sqrt</span><span class="op">)</span></span>
<span><span class="fu">logged_sqrt</span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calling function with args: 16 
Result: 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>If you want to do this with Python, here take a look:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> with_logging(f):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> call(<span class="op">*</span>args):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        args_str <span class="op">=</span> <span class="st">", "</span>.join(<span class="bu">str</span>(a) <span class="cf">for</span> a <span class="kw">in</span> args)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Calling function with args: </span><span class="sc">{</span>args_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> f(<span class="op">*</span>args)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Result: </span><span class="sc">{</span>res<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> call</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="at">@with_logging</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logged_sqrt(x):</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logged_sqrt(<span class="dv">16</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calling function with args: 16
Result: 4.0
4.0</code></pre>
</div>
</div>
</section><section id="example-2-creating-a-memoization-operator" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="example-2-creating-a-memoization-operator">
<span class="header-section-number">2.3.2</span> Example 2: Creating a Memoization Operator</h3>
<p>Memoization caches function results to speed up repeated calls:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">memoize</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cache</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="va">key</span>, envir <span class="op">=</span> <span class="va">cache</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">cache</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">f</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">cache</span><span class="op">[[</span><span class="va">key</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">slow_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> </span>
<span>    <span class="va">x</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fast_function</span> <span class="op">=</span> <span class="fu">memoize</span><span class="op">(</span><span class="va">slow_function</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">fast_function</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.00    0.00    1.01 </code></pre>
</div>
</div>
</section></section></section><section id="program" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Level 3: Programmatic Approach</h1>
<p>Swear, this is not an easy thing to do — you need at least better understanding on how to build / generate expressions in R, and this involves understanding metaprogramming in R — Yes, most of the part on manipulating ASTs.</p>
<p>The <code><a href="https://rlang.r-lib.org/reference/new_function.html">rlang::new_function()</a></code> provides an API that programmatically constructs a function expression (yes, it does creates formals, body, and an environment — 3 main components of R functions). Keep in mind that the construction of the function expression with <code><a href="https://rlang.r-lib.org/reference/new_function.html">rlang::new_function()</a></code> happens in runtime.</p>
<section id="start-with-the-basic-first" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="start-with-the-basic-first">
<span class="header-section-number">3.1</span> Start with the basic first</h2>
<p>The <code>new_function()</code> function takes three arguments:</p>
<ul>
<li>
<code>args</code>: The formal arguments under that function</li>
<li>
<code>body</code>: An expression that takes the function body</li>
<li>
<code>env</code>: If supplied, this will be the parent environment of the function.</li>
</ul>
<p>Let’s start with a function that squares the number:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span></span>
<span>    <span class="va">rlang</span><span class="op">[</span><span class="va">new_function</span>, <span class="va">expr</span>, <span class="va">caller_env</span>, <span class="va">call2</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">square</span> <span class="op">=</span> <span class="fu">new_function</span><span class="op">(</span></span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">expr</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    body <span class="op">=</span> <span class="fu">call2</span><span class="op">(</span><span class="st">"{"</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    env <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">square</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
</div>
<p>Or instead of <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> in <code>args</code> parameter, how about using <code>pairlist2()</code> instead?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span><span class="va">rlang</span><span class="op">[</span><span class="va">pairlist2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">square2</span> <span class="op">=</span> <span class="fu">new_function</span><span class="op">(</span></span>
<span>    args <span class="op">=</span> <span class="fu">pairlist2</span><span class="op">(</span>x <span class="op">=</span> <span class="op">)</span>, </span>
<span>    body <span class="op">=</span> <span class="fu">expr</span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>    env <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">square2</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
</div>
<p>Alright, you might be asking: What’s the point of using <code>new_function()</code> if we can just use <code>function()</code> instead? The purpose of this approach is that you can <em>programmatically generate functions</em> based on data or configuration.</p>
<p>In fact, this is how I <em>automatically</em> generate <code><a href="https://torch.mlverse.org/docs/reference/nn_module.html">torch::nn_module()</a></code> expression used in my new R package called <a href="https://kindling.joshuamarie.com">kindling</a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html">use</a></span><span class="op">(</span><span class="va">kindling</span><span class="op">[</span><span class="va">ffnn_generator</span>, <span class="va">act_funs</span>, <span class="va">args</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ffnn_generator</span><span class="op">(</span></span>
<span>    nn_name <span class="op">=</span> <span class="st">"MyFFNN2"</span>,</span>
<span>    hd_neurons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">64</span>, <span class="fl">32</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>    no_x <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    no_y <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    activations <span class="op">=</span> <span class="fu">act_funs</span><span class="op">(</span></span>
<span>        <span class="va">relu</span>,</span>
<span>        <span class="va">selu</span>,</span>
<span>        softshrink <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span>lambd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        <span class="st">"celu(alpha = 0.5)"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch::nn_module("MyFFNN2", initialize = function () 
{
    self$fc1 = torch::nn_linear(20, 128, bias = TRUE)
    self$fc2 = torch::nn_linear(128, 64, bias = TRUE)
    self$fc3 = torch::nn_linear(64, 32, bias = TRUE)
    self$fc4 = torch::nn_linear(32, 15, bias = TRUE)
    self$out = torch::nn_linear(15, 5, bias = TRUE)
}, forward = function (x) 
{
    x = self$fc1(x)
    x = torch::nnf_relu(x)
    x = self$fc2(x)
    x = torch::nnf_selu(x)
    x = self$fc3(x)
    x = torch::nnf_softshrink(x, lambd = 0.5)
    x = self$fc4(x)
    x = torch::nnf_celu(x, alpha = 0.5)
    x = self$out(x)
    x
})</code></pre>
</div>
</div>
<p>In which, this function is a reference from this <a href="https://joshuamarie.com/posts/01-meta-nn/">blog post</a> of mine quite a while ago, based on what I learned in <a href="https://adv-r.hadley.nz">Advanced R</a> to automatically generate <code><a href="https://torch.mlverse.org/docs/reference/nn_module.html">torch::nn_module()</a></code>.</p>
</section></section><section id="when-to-use-each-approach-here-are-some-of-my-guides" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> When to Use Each Approach (here are some of my guides)</h1>
<ul>
<li>
<strong>Level 1 (Manual)</strong>: When you’re prototyping, the logic is simple, or you need maximum clarity</li>
<li>
<strong>Level 2 (Higher-order)</strong>: When you want to reuse composition patterns and keep code DRY (Don’t Repeat Yourself)</li>
<li>
<strong>Level 3 (Programmatic)</strong>: When you’re building frameworks, DSLs, or need to generate many similar functions from specifications (my package <a href="https://kindling.joshuamarie.com">kindling</a> is one of the many example packages)</li>
</ul></section><section id="resources" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Resources</h1>
<ul>
<li><a href="https://adv-r.hadley.nz">Advanced R by Hadley Wickham</a></li>
<li><a href="https://purrr.tidyverse.org/">Functional Programming in R with purrr</a></li>
<li><a href="https://rlang.r-lib.org/">rlang Documentation</a></li>
</ul>


</section></main><!-- /main --><style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

/* Light theme variables */
:root {
  --primary-color: #3b82f6;
  --primary-dark: #2563eb;
  --secondary-color: #64748b;
  --accent-color: #06b6d4;
  --background: #ffffff;
  --surface: #f8fafc;
  --surface-hover: #f1f5f9;
  --surface-light: #e2e8f0;
  --border: #e2e8f0;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --radius: 8px;
  --radius-lg: 12px;
}

/* Dark theme variables */
[data-theme="dark"] {
  --primary-color: #60a5fa;
  --primary-dark: #3b82f6;
  --secondary-color: #94a3b8;
  --accent-color: #22d3ee;
  --background: #0f172a;
  --surface: #1e293b;
  --surface-hover: #334155;
  --surface-light: #475569;
  --border: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.5);
}

/* =========================
   Navbar Theme Fix
   ========================= */

/* Target all navbar elements to use theme colors */
.navbar,
.navbar-default,
.navbar-expand-lg,
nav.navbar,
header.navbar,
#quarto-header,
.quarto-navbar,
nav[role="navigation"] {
  background: var(--background) !important;
  border-bottom: 1px solid var(--border) !important;
  box-shadow: var(--shadow-sm) !important;
}

/* =========================
   Title Block Banner Theme Fix
   ========================= */

/* Target title block banner area */
#title-block-header,
.quarto-title-block,
header#title-block-header,
.quarto-title-banner {
  background: var(--background) !important;
  color: var(--text-primary) !important;
}

/* Title block container */
.quarto-title-block .quarto-title,
#title-block-header .quarto-title {
  background: var(--background) !important;
}

/* =========================
   Listing Controls Theme Fix (Sorter/Filter)
   ========================= */

/* Order By / Sort dropdown and Filter input */
.listing-option-group,
.listing-actions,
.listing-controls,
div[class*="listing"] {
  background: var(--background) !important;
}

/* Dropdowns and inputs in listing controls */
.listing-option-group select,
.listing-option-group input,
#listing-order-by,
select,
input[type="text"],
input[type="search"] {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border) !important;
}

.listing-option-group select:hover,
.listing-option-group input:hover,
select:hover,
input[type="text"]:hover,
input[type="search"]:hover {
  background: var(--surface-hover) !important;
  border-color: var(--primary-color) !important;
}

/* Labels in listing controls */
.listing-option-group label,
.listing-controls label {
  color: var(--text-primary) !important;
}

/* =========================
   Footer Theme Fix
   ========================= */

/* Footer area */
footer,
.footer,
.nav-footer,
.quarto-footer,
body > footer,
#quarto-footer {
  background: var(--surface) !important;
  color: var(--text-secondary) !important;
  border-top: 1px solid var(--border) !important;
}

/* Footer links */
footer a,
.footer a,
.nav-footer a,
.quarto-footer a {
  color: var(--text-secondary) !important;
}

footer a:hover,
.footer a:hover,
.nav-footer a:hover,
.quarto-footer a:hover {
  color: var(--primary-color) !important;
}

/* Footer text */
footer p,
footer div,
.footer p,
.footer div,
.nav-footer p,
.nav-footer div {
  color: var(--text-secondary) !important;
}

/* Navbar brand/logo */
.navbar-brand,
.navbar-title,
a.navbar-brand {
  color: var(--text-primary) !important;
}

/* Navbar links */
.navbar-nav .nav-link,
.navbar .nav-link,
.navbar a,
.nav-link {
  color: var(--text-secondary) !important;
}

.navbar-nav .nav-link:hover,
.navbar .nav-link:hover,
.navbar a:hover,
.nav-link:hover {
  color: var(--primary-color) !important;
}

/* Active navbar link */
.navbar-nav .nav-link.active,
.navbar .nav-link.active,
.nav-link.active {
  color: var(--primary-color) !important;
}

/* Navbar toggler*/
.navbar-toggler {
  border-color: var(--border) !important;
  padding: 0.25rem 0.5rem;
}

.navbar-toggler:focus {
  box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

/* Create custom hamburger icon that respects theme */
.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(71, 85, 105, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
  display: inline-block;
  width: 1.5em;
  height: 1.5em;
  vertical-align: middle;
}

/* Dark theme hamburger icon */
[data-theme="dark"] .navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(203, 213, 225, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
}

/* Search button and icons in navbar */
.navbar .quarto-navbar-tools,
.navbar-nav .nav-item i,
.navbar i {
  color: var(--text-secondary) !important;
}

.navbar .quarto-navbar-tools:hover,
.navbar-nav .nav-item i:hover,
.navbar i:hover {
  color: var(--primary-color) !important;
}

/* Theme toggle button - repositioned to avoid navbar overlap */
.theme-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  background: var(--primary-color);
  color: white;
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.25rem;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background: var(--primary-dark);
  transform: scale(1.1);
  box-shadow: 0 15px 25px -5px rgb(0 0 0 / 0.3);
}

.theme-toggle:active {
  transform: scale(0.95);
}

/* Base styles with smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Remove automatic numbering for headings */
body {
  counter-reset: none;
}

h1::before,
h2::before,
h3::before,
h4::before,
h5::before,
h6::before {
  content: none !important;
}

/* Override any automatic numbering */
.section .header-section-number {
  display: none !important;
}

.header-section-number {
  display: none !important;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  line-height: 1.7;
  color: var(--text-primary);
  background: var(--background);
  margin: 0;
  padding: 0;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Container styling */
.container-fluid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  padding-top: 4rem; 
}

/* Header styling with enhanced animations */
.title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  line-height: 1.2;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: slideInFromTop 0.8s ease-out;
}

.subtitle {
  font-size: 1.25rem;
  color: var(--text-secondary);
  margin-bottom: 2rem;
  font-weight: 400;
  animation: slideInFromTop 0.8s ease-out 0.2s both;
}

.author, .date {
  color: var(--text-muted);
  font-size: 1.325rem;
  margin-bottom: 0.5rem;
  animation: slideInFromTop 0.8s ease-out 0.4s both;
}

/* Animations */
@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* =========================
   Table of Contents
   ========================= */

#TOC {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-sm);
  animation: fadeIn 0.8s ease-out 0.6s both;
}

/* Force all TOC elements to use theme colors */
#TOC,
#TOC ul,
#TOC li,
#TOC div {
  background: var(--surface) !important;
  color: var(--text-primary) !important;
}

/* Hide "on this page" text in TOC - Multiple selectors for compatibility */
body.quarto-post #TOC .toc-title,
#TOC .toc-title,
.toc-title,
#quarto-margin-sidebar .toc-title,
.sidebar nav[role="doc-toc"] > h2,
.sidebar nav[role="doc-toc"] > .h2,
#quarto-margin-sidebar h2,
aside[role="complementary"] h2,
nav[role="doc-toc"] h2 {
  display: none !important;
}

#TOC ul {
  margin: 0;
  padding-left: 1.25rem;
  list-style: none;
  background: var(--surface) !important;
}

#TOC > ul {
  padding-left: 0;
  background: var(--surface) !important;
}

#TOC li {
  margin: 0.5rem 0;
  position: relative;
  transform: translateX(0);
  transition: transform 0.2s ease;
  background: var(--surface) !important;
}

#TOC li:hover {
  transform: translateX(5px);
  background: var(--surface) !important;
}

#TOC li::before {
  content: "→";
  color: var(--primary-color);
  font-weight: bold;
  position: absolute;
  left: -1rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

#TOC li:hover::before {
  opacity: 1;
}

#TOC a {
  color: var(--text-primary) !important;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.2s ease;
  display: block;
  padding: 0.25rem 0;
  border-radius: var(--radius);
  padding-left: 0.5rem;
  background: transparent !important;
}

#TOC a:hover {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Target specific R Markdown TOC structure */
.tocify-wrapper,
.tocify-extend-page {
  background: var(--surface) !important;
}

/* Override any white backgrounds in TOC */
#TOC * {
  background-color: var(--surface) !important;
}

#TOC a * {
  background-color: transparent !important;
}

/* Floating TOC with enhanced styling */
.tocify {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  padding: 1rem;
  backdrop-filter: blur(10px);
}

.tocify-header {
  font-weight: 600;
  color: var(--text-primary) !important;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 0.5rem;
}

.tocify-item {
  padding: 0.25rem 0;
}

.tocify-item a {
  color: var(--text-secondary) !important;
  text-decoration: none;
  transition: all 0.2s ease;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius);
  display: block;
}

.tocify-item a:hover,
.tocify-item.active a {
  color: var(--primary-color) !important;
  background: var(--surface-hover) !important;
}

/* Headers styling */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  margin-top: 2.5rem;
  margin-bottom: 1rem;
  line-height: 1.3;
  color: var(--text-primary);
}

h1 {
  font-size: 2.25rem;
  border-bottom: 3px solid var(--primary-color);
  padding-bottom: 0.75rem;
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
}

h1::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: -100%;
  right: 100%;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
  animation: shimmer 2s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% {
    left: -100%;
    right: 100%;
  }
  50% {
    left: 0%;
    right: 0%;
  }
}

h2 {
  font-size: 1.875rem;
  color: var(--primary-dark);
  position: relative;
  padding-left: 1rem;
}

h2::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0.25rem;
  bottom: 0.25rem;
  width: 4px;
  background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
  border-radius: 2px;
  transform: scaleY(0);
  transform-origin: top;
  transition: transform 0.3s ease;
}

h2:hover::before {
  transform: scaleY(1);
}

h3 {
  font-size: 1.5rem;
  color: var(--text-primary);
}

h4 {
  font-size: 1.25rem;
  color: var(--secondary-color);
}

/* Interactive code folding button */
.code-folding-btn {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  border: none;
  padding: 0.75rem 1.25rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 600;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
}

.code-folding-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.code-folding-btn:active {
  transform: translateY(0);
}

.code-folding-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.code-folding-btn:hover::after {
  left: 100%;
}

/* =========================
   Callout title
   ========================= */

.callout-title-container {
  color: #19183B !important;
}

/* =========================
   Global hyperlink styling
   ========================= */

/* Global styling - Light mode */
a:not(.quarto-category):not(.listing-category),
a:visited:not(.quarto-category):not(.listing-category) {
  color: #3A6F43 !important;
  text-decoration: none;
}

a:hover:not(.quarto-category):not(.listing-category) {
  color: #333333 !important;
}

/* Dark mode hyperlinks */
[data-theme="dark"] a:not(.quarto-category):not(.listing-category),
[data-theme="dark"] a:visited:not(.quarto-category):not(.listing-category) {
  color: #8BAE66 !important;
}

[data-theme="dark"] a:hover:not(.quarto-category):not(.listing-category) {
  color: #a8cc88 !important;
}

/* =========================
   Category Links Fix
   ========================= */

/* Ensure category links remain functional */
.quarto-category,
a.quarto-category,
.quarto-categories .quarto-category,
.listing-category,
a.listing-category {
  pointer-events: auto !important;
  cursor: pointer !important;
  color: inherit !important;
  text-decoration: none !important;
}

.quarto-category:hover,
.listing-category:hover {
  opacity: 0.8 !important;
  text-decoration: none !important;
}

/* =========================
   Strong Global bold text
   ========================= */

strong, b {
  font-weight: 700;
}

/* Enhanced blockquotes */
blockquote {
  border-left: 4px solid var(--accent-color);
  margin: 1.5rem 0;
  padding: 1rem 1.5rem;
  background: var(--surface);
  border-radius: 0 var(--radius) var(--radius) 0;
  color: var(--text-secondary);
  font-style: italic;
  position: relative;
  box-shadow: var(--shadow-sm);
}

blockquote::before {
  content: """;
  font-size: 3rem;
  color: var(--accent-color);
  position: absolute;
  top: -10px;
  left: 10px;
  opacity: 0.3;
}

/* Smooth scrolling and enhanced focus */
html {
  scroll-behavior: smooth;
}

/* Selection styling */
::selection {
  background: var(--primary-color);
  color: white;
}

::-moz-selection {
  background: var(--primary-color);
  color: white;
}

/* Enhanced focus styles */
button:focus,
a:focus,
input:focus,
textarea:focus {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
  border-radius: var(--radius);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: var(--surface);
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 6px;
  border: 2px solid var(--surface);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--secondary-color);
}

/* Responsive design */
@media (max-width: 768px) {
  .theme-toggle {
    bottom: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
    font-size: 1.1rem;
  }
  
  .container-fluid {
    padding: 1rem;
    padding-top: 3rem;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .subtitle {
    font-size: 1.725rem;
  }
  
  h1 {
    font-size: 1.875rem;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  pre {
    padding: 1rem;
  }
  
  pre code {
    font-size: 0.9rem;
  }
}

/* Print styles */
@media print {
  .theme-toggle {
    display: none;
  }
  
  body {
    font-size: 12pt;
    line-height: 1.5;
    color: black;
    background: white;
  }
  
  .title {
    color: black;
    -webkit-text-fill-color: black;
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: black;
    page-break-after: avoid;
  }
  
  pre, blockquote {
    page-break-inside: avoid;
  }
  
  .tocify {
    display: none;
  }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.createElement('button');
  themeToggle.className = 'theme-toggle';
  themeToggle.innerHTML = '🌙';
  themeToggle.setAttribute('aria-label', 'Toggle dark mode');
  themeToggle.setAttribute('title', 'Toggle dark/light mode');
  
  document.body.appendChild(themeToggle);
  
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  themeToggle.innerHTML = savedTheme === 'dark' ? '🌙' : '☀️';
  
  themeToggle.addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    themeToggle.innerHTML = newTheme === 'dark' ? '🌙' : '☀️';
    
    themeToggle.style.transform = 'rotate(360deg)';
    setTimeout(() => {
      themeToggle.style.transform = 'rotate(0deg)';
    }, 300);
  });
  
  setTimeout(function() {
    const tocTitles = document.querySelectorAll('.toc-title, #quarto-margin-sidebar h2, nav[role="doc-toc"] h2');
    tocTitles.forEach(function(title) {
      title.style.display = 'none';
    });
  }, 100);
  
  const tocLinks = document.querySelectorAll('#TOC a, .tocify a');
  tocLinks.forEach(function(link) {
    link.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });
  
  const images = document.querySelectorAll('img');
  images.forEach(function(img) {
    if (img.complete) {
      img.style.opacity = '1';
    } else {
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.5s ease';
      
      img.addEventListener('load', function() {
        this.style.opacity = '1';
      });
    }
  });
});
</script><style>
    /* Modal Styles */
    .code-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
    }

    .code-modal-content {
        position: relative;
        background-color: #fff;
        margin: 5% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 1200px;
        max-height: 80vh;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .code-modal-header {
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
    }

    .code-modal-title {
        font-size: 1.2em;
        font-weight: 600;
        margin: 0;
    }

    .code-modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }

    .code-modal-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .code-modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background-color: #f8f9fa;
    }

    .code-modal-section {
        margin-bottom: 20px;
    }

    .code-modal-section:last-child {
        margin-bottom: 0;
    }

    .code-modal-section h3 {
        margin: 0 0 10px 0;
        font-size: 1.1em;
        color: #333;
        padding-bottom: 5px;
        border-bottom: 2px solid #1e3a8a;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .code-modal-code {
        background-color: #0f172a;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        overflow-x: auto;
        white-space: pre;
        margin: 0;
    }

    .code-modal-output {
        background-color: #fff;
        border: 1px solid #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.4;
        white-space: pre-wrap;
        margin: 0;
        color: #2d3748;
    }

    /* Button to open modal */
    .code-open-btn {
        background: #0f172a;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85em;
        font-weight: 500;
        margin: 5px 0;
        transition: all 0.3s ease;
    }

    .code-open-btn:hover {
        background: #1e293b;
        transform: translateY(-1px);
    }

    /* Copy button styles */
    .copy-btn {
        background: #1e3a8a;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.75em;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s ease;
    }

    .copy-btn:hover {
        background: #1e40af;
    }

    .copy-btn.copied {
        background: #059669;
    }

    .copy-icon {
        width: 14px;
        height: 14px;
        fill: currentColor;
    }

    /* Hide original code blocks that have code-open */
    .cell[data-code-open="true"] .sourceCode {
        display: none;
    }

    .cell[data-code-open="true"] .cell-output {
        display: none;
    }

    /* Animation */
    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .code-modal.show .code-modal-content {
        animation: modalFadeIn 0.3s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .code-modal-content {
            width: 95%;
            margin: 2% auto;
            max-height: 90vh;
        }

        .code-modal-header {
            padding: 10px 15px;
        }

        .code-modal-body {
            padding: 15px;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to create modal
        function createModal() {
            const modal = document.createElement('div');
            modal.className = 'code-modal';
            document.body.appendChild(modal);
            return modal;
        }

        // Create the modal
        const modal = createModal();
        const modalContent = modal.querySelector('.code-modal-content');
        const closeBtn = modal.querySelector('.code-modal-close');
        const codeElement = modal.querySelector('.code-modal-code');
        const outputElement = modal.querySelector('.code-modal-output');

        // Function to open modal
        function openModal(codeText, outputText, title = 'Code & Output') {
            modal.querySelector('.code-modal-title').textContent = title;
            codeElement.textContent = codeText;
            outputElement.textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }

        // Function to close modal
        function closeModal() {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        // Event listeners for modal
        closeBtn.addEventListener('click', closeModal);

        // Copy functionality
        const copyCodeBtn = modal.querySelector('#copy-code-btn');
        const copyOutputBtn = modal.querySelector('#copy-output-btn');

        copyCodeBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(codeElement.textContent);
                copyCodeBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyCodeBtn.classList.add('copied');
                setTimeout(() => {
                    copyCodeBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyCodeBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy code:', err);
            }
        });

        copyOutputBtn.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(outputElement.textContent);
                copyOutputBtn.innerHTML = `
                    <svg class="copy-icon" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Copied!
                `;
                copyOutputBtn.classList.add('copied');
                setTimeout(() => {
                    copyOutputBtn.innerHTML = `
                        <svg class="copy-icon" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy
                    `;
                    copyOutputBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy output:', err);
            }
        });

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        // Function to extract title from Quarto cell metadata
        function extractTitleFromCell(cell) {
            // Look for code-modal-title in various places
            let title = null;

            // 1. Check for data attribute on the cell
            if (cell.hasAttribute('data-code-modal-title')) {
                title = cell.getAttribute('data-code-modal-title');
            }

            // 2. Check for code-modal-title in cell options (Quarto metadata)
            const cellOptions = cell.querySelector('.cell-meta, .cell-code-meta');
            if (cellOptions && !title) {
                const optionsText = cellOptions.textContent;
                const titleMatch = optionsText.match(/code-modal-title:\s*["']([^"']+)["']/);
                if (titleMatch) {
                    title = titleMatch[1];
                }
            }

            // 3. Look for title in HTML comments (Quarto sometimes puts metadata there)
            const htmlContent = cell.innerHTML;
            const commentMatch = htmlContent.match(/<!--.*?code-modal-title:\s*["']([^"']+)["'].*?-->/s);
            if (commentMatch && !title) {
                title = commentMatch[1];
            }

            // 4. Look for title in the cell's script tags or data attributes
            const scripts = cell.querySelectorAll('script[type="application/json"]');
            scripts.forEach(script => {
                if (!title) {
                    try {
                        const data = JSON.parse(script.textContent);
                        if (data['code-modal-title']) {
                            title = data['code-modal-title'];
                        }
                    } catch (e) {
                        // Ignore JSON parse errors
                    }
                }
            });

            // 5. Look in the raw text content for the pattern
            if (!title) {
                const rawText = cell.textContent;
                const rawMatch = rawText.match(/code-modal-title:\s*["']?([^"'\n]+)["']?/);
                if (rawMatch) {
                    title = rawMatch[1].trim().replace(/["']/g, '');
                }
            }

            // 6. Alternative pattern matching for YAML-like syntax
            if (!title) {
                const yamlMatch = htmlContent.match(/code-modal-title:\s*(.+)/);
                if (yamlMatch) {
                    title = yamlMatch[1].trim().replace(/["']/g, '');
                }
            }

            return title;
        }

        // Function to process code blocks with code-open attribute
        function processCodeOpenBlocks() {
            // Look for cells with code-open attribute in Quarto
            const cells = document.querySelectorAll('.cell');

            cells.forEach((cell, index) => {
                // Skip if already processed
                if (cell.hasAttribute('data-processed')) return;

                // Check if this cell should have code-open functionality
                const hasCodeOpen = cell.querySelector('[data-code-open="true"]') ||
                    cell.hasAttribute('data-code-open') ||
                    cell.innerHTML.includes('code-open: true') ||
                    cell.textContent.includes('code-open: true');

                if (hasCodeOpen) {
                    // Mark the cell as processed
                    cell.setAttribute('data-code-open', 'true');
                    cell.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(cell);

                    // Find source code
                    const sourceCode = cell.querySelector('.sourceCode code, pre code, .r code');
                    const codeText = sourceCode ? sourceCode.textContent : '';

                    // Find output
                    const outputElements = cell.querySelectorAll('.cell-output pre, .cell-output .output');
                    let outputText = '';
                    outputElements.forEach(output => {
                        outputText += output.textContent + '\n';
                    });

                    // Create open button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        // Use custom title if available, otherwise default
                        const title = customTitle || `Code Block ${index + 1}`;
                        openModal(codeText, outputText.trim(), title);
                    });

                    // Insert button at the beginning of the cell
                    cell.insertBefore(openBtn, cell.firstChild);
                }
            });
        }

        // Alternative approach for direct code blocks
        function processDirectCodeBlocks() {
            const codeBlocks = document.querySelectorAll('pre code');

            codeBlocks.forEach(code => {
                const preElement = code.parentElement;
                const container = preElement.parentElement;

                // Skip if already processed
                if (container.hasAttribute('data-processed')) return;

                // Check for code-open in various ways
                if (container.hasAttribute('data-code-open') ||
                    container.classList.contains('code-open') ||
                    preElement.hasAttribute('data-code-open') ||
                    container.innerHTML.includes('code-open: true')) {

                    // Mark as processed
                    container.setAttribute('data-processed', 'true');

                    // Extract custom title
                    const customTitle = extractTitleFromCell(container);

                    const codeText = code.textContent;

                    // Look for adjacent output
                    let outputText = '';
                    let nextElement = container.nextElementSibling;
                    if (nextElement && (nextElement.tagName === 'PRE' || nextElement.classList.contains('output'))) {
                        outputText = nextElement.textContent;
                    }

                    // Create and insert button
                    const openBtn = document.createElement('button');
                    openBtn.className = 'code-open-btn';
                    openBtn.textContent = 'View Code & Output';

                    openBtn.addEventListener('click', function() {
                        const title = customTitle || 'Code Block';
                        openModal(codeText, outputText, title);
                    });

                    // Hide original and add button
                    container.style.display = 'none';
                    if (nextElement && outputText) {
                        nextElement.style.display = 'none';
                    }

                    container.parentElement.insertBefore(openBtn, container);
                }
            });
        }

        // Run processing functions
        processCodeOpenBlocks();
        processDirectCodeBlocks();

        // Also run after a short delay to catch dynamically loaded content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 1000);

        // Run again after a longer delay for slow-loading content
        setTimeout(() => {
            processCodeOpenBlocks();
            processDirectCodeBlocks();
        }, 3000);
    });

    // Manual function to add code-open functionality
    function addCodeOpen(codeElement, outputElement, title) {
        const openBtn = document.createElement('button');
        openBtn.className = 'code-open-btn';
        openBtn.textContent = 'View Code & Output';

        openBtn.addEventListener('click', function() {
            const codeText = codeElement.textContent;
            const outputText = outputElement ? outputElement.textContent : '';

            // Trigger the modal (assuming the modal is already created)
            const modal = document.querySelector('.code-modal');
            if (modal) {
                const event = new CustomEvent('openCodeModal', {
                    detail: { codeText, outputText, title }
                });
                document.dispatchEvent(event);
            }
        });

        return openBtn;
    }

    // Listen for custom events
    document.addEventListener('openCodeModal', function(e) {
        const { codeText, outputText, title } = e.detail;
        const modal = document.querySelector('.code-modal');
        if (modal) {
            modal.querySelector('.code-modal-title').textContent = title || 'Code & Output';
            modal.querySelector('.code-modal-code').textContent = codeText;
            modal.querySelector('.code-modal-output').textContent = outputText || 'No output';
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            document.body.style.overflow = 'hidden';
        }
    });
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/joshuamarie\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><script src="https://utteranc.es/client.js" repo="joshuamarie/joshuamarie.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Design inspired by <a href="https://github.com/statichunt/geeky-hugo">Geeky Hugo</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/edit/main/posts/11-composing-r-function/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/joshuamarie/joshuamarie.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>